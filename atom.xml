<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>徐子辉的个人站点</title>
  
  <subtitle>在总结中一步步提升自己，要善于总结，好记性不如烂笔头.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2025-12-22T13:54:51.714Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>xuzh</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>C语言定义指针变量并正确初始化</title>
    <link href="http://yoursite.com/2025/12/22/C%E8%AF%AD%E8%A8%80%E5%AE%9A%E4%B9%89%E6%8C%87%E9%92%88%E5%8F%98%E9%87%8F%E5%B9%B6%E6%AD%A3%E7%A1%AE%E5%88%9D%E5%A7%8B%E5%8C%96/"/>
    <id>http://yoursite.com/2025/12/22/C%E8%AF%AD%E8%A8%80%E5%AE%9A%E4%B9%89%E6%8C%87%E9%92%88%E5%8F%98%E9%87%8F%E5%B9%B6%E6%AD%A3%E7%A1%AE%E5%88%9D%E5%A7%8B%E5%8C%96/</id>
    <published>2025-12-22T13:21:17.000Z</published>
    <updated>2025-12-22T13:54:51.714Z</updated>
    
    <content type="html"><![CDATA[<p>用C语言实现贪吃蛇游戏过程中，定义蛇身节点是用到了结构体和指针。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 蛇身节点结构体，用于存储每个蛇身段的位置坐标</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> x;  <span class="comment">// x坐标</span></span><br><span class="line">    <span class="type">int</span> y;  <span class="comment">// y坐标</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">next</span>;</span>  <span class="comment">// 指向下一个节点的指针</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>在函数中定义蛇身（头部）节点时，我第一个想法是这样定义<code>struct Node *head</code>，但实际上完整的写法是<code>struct Node *head = (struct Node*)malloc(sizeof(struct Node));</code>。那么就要探究这两个写法的不同。</p><span id="more"></span><h2 id="head-struct-nodemallocsizeofstruct-node">1 head = (structNode*)malloc(sizeof(struct Node));</h2><p>这段 C 语言代码的核心作用是在堆内存中为自定义结构体structNode分配一块内存，并将这块内存的起始地址赋值给指针变量head。下面分模块拆解说明：</p><h3 id="前置知识struct-node自定义结构体">1.1 前置知识：structNode（自定义结构体）</h3><p>代码中隐含了一个提前定义的结构体类型structNode（否则编译器会报错），例如链表节点的典型定义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义结构体：表示链表节点</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;          <span class="comment">// 数据域：存储节点数据</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span> <span class="comment">// 指针域：指向下一个节点</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>struct Node</code>是一种用户自定义的数据类型，占用的内存大小由其成员变量决定（比如上面的定义占<code>sizeof(int) + sizeof(struct Node*)</code> 字节）。</p><h3 id="核心函数mallocsizeofstruct-node">1.2核心函数：malloc(sizeof(struct Node))</h3><h4 id="malloc-是什么">（1）malloc 是什么？</h4><p><code>malloc</code> 是 C 标准库的动态内存分配函数（声明在<code>&lt;stdlib.h&gt;</code>头文件中），功能是：从堆内存（而非栈内存）中分配一块连续的、指定字节数的内存；返回值：分配成功则返回内存块的起始地址（类型为<code>void*</code>，无类型指针）；分配失败（如内存不足）则返回<code>NULL</code>。 #### （2）sizeof(struct Node)：计算内存分配大小<code>sizeof</code> 是 C 的运算符，用于计算某一类型 /变量占用的字节数。<code>sizeof(struct Node)</code>会精准计算出一个<code>struct Node</code>结构体实例所需的字节数，确保<code>malloc</code>分配的内存刚好能容纳该结构体（避免内存不足或浪费）。</p><h3 id="类型转换struct-node">1.3 类型转换：(struct Node*)</h3><p><code>malloc</code> 的返回值是<code>void*</code>（无类型指针），而<code>head</code>是<code>struct Node*</code>类型的指针（结构体指针）。<code>(struct Node*)</code>是强制类型转换，将<code>malloc</code>返回的<code>void*</code>转换为<code>struct Node*</code>类型，目的是：</p><ul><li>让编译器明确这块内存的用途（存储structNode类型的数据），避免类型不匹配的编译警告（尤其是严格编译模式下）；</li><li>注意：C语言中void*可以隐式转换为其他指针类型（因此有人会省略强制转换，写成 head= malloc(sizeof(struct Node))），但显式转换更清晰，也兼容 C++（C++要求必须显式转换）。</li></ul><h3 id="赋值操作head-...">1.4 赋值操作：head = ...</h3><p><code>head</code>是一个提前声明的<code>struct Node*</code>类型指针变量（即<code>struct Node *head;</code>），赋值后：</p><ul><li>head 指向堆内存中刚分配的struct Node结构体实例；</li><li>后续可通过head指针操作这块内存（比如 head-&gt;data = 10;给结构体成员赋值）。</li></ul><h3 id="完整代码示例带错误检查和内存释放">1.5完整代码示例（带错误检查和内存释放）</h3><p>这段代码单独写存在风险（未检查<code>malloc</code>返回值、未释放内存），完整的规范写法如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span> <span class="comment">// 必须包含malloc/free/exit的头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结构体</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">head</span>;</span> <span class="comment">// 声明结构体指针</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态分配内存（核心代码）</span></span><br><span class="line">    head = (<span class="keyword">struct</span> Node*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> Node));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关键：检查malloc是否分配成功（避免NULL指针解引用崩溃）</span></span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;malloc failed&quot;</span>); <span class="comment">// 打印错误原因</span></span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);      <span class="comment">// 退出程序</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用分配的内存：给结构体成员赋值</span></span><br><span class="line">    head-&gt;data = <span class="number">10</span>;</span><br><span class="line">    head-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Node data: %d\n&quot;</span>, head-&gt;data); <span class="comment">// 输出：Node data: 10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 释放内存：堆内存需手动释放，否则造成内存泄漏</span></span><br><span class="line">    <span class="built_in">free</span>(head);</span><br><span class="line">    head = <span class="literal">NULL</span>; <span class="comment">// 置空指针，避免野指针（free后原地址仍可访问，但内存已失效）</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="关键注意事项">1.6. 关键注意事项</h3><ul><li>必须包含头文件：使用<code>malloc</code>必须包含<code>&lt;stdlib.h&gt;</code>，否则编译器会报 “implicit declaration offunction ‘malloc’” 错误；</li><li>必须检查返回值：malloc可能分配失败（返回NULL），直接解引用NULL指针会导致程序崩溃（段错误）；</li><li>手动释放内存：堆内存不会像栈内存那样自动释放，使用完必须调用free(head)，否则会造成内存泄漏；</li><li>避免野指针：free(head)后，head仍指向原内存地址（但内存已被系统回收），需手动置为NULL。</li></ul><h2 id="struct-node-head">2 struct Node* head;</h2><p>首先要分清两个概念：指针变量本身 和 指针指向的内存（数据本体）——struct Node* head; 只创建了 “指针变量”，但没有创建 “节点数据本体”；而malloc 才是为 “节点数据本体” 分配内存，让指针有可操作的有效地址。</p><h3 id="先看只写-struct-node-head-会发生什么">2.1 先看：只写 structNode* head; 会发生什么？</h3><p>这段代码的本质是声明了一个指针变量，但未给它绑定任何有效的内存空间：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">head</span>;</span> <span class="comment">// 仅声明指针变量</span></span><br><span class="line">    <span class="comment">// 尝试操作指针指向的内存：直接崩溃！</span></span><br><span class="line">    head-&gt;data = <span class="number">10</span>; <span class="comment">// 段错误（Segmentation fault）</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关键原因：</p><p><code>指针变量本身存在，但指向随机地址：</code> head作为局部变量，会在栈内存中分配一小块空间（比如 64 位系统占 8字节），用于存储 “内存地址”；但未初始化时，这个地址是随机的垃圾值（即“野指针”）。</p><p><code>解引用野指针 = 操作非法内存：</code> head-&gt;data = 10试图往这个随机地址写入数据，而这个地址大概率不属于当前程序的内存空间，操作系统会直接终止程序（段错误）——这是 C 语言中典型的 “未定义行为”。</p><h3 id="如果想-直接定义-出可用的节点有两种写法但都有局限">2.2 如果想“直接定义” 出可用的节点，有两种写法，但都有局限</h3><p>你可能误以为 “直接定义” 是指 “不写malloc”，其实真正能直接定义的是结构体实例（数据本体），而非仅定义指针：</p><p>写法 1：定义栈上的结构体实例，再让指针指向它</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> <span class="title">node</span>;</span> <span class="comment">// 直接定义栈上的节点本体（数据存在）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">head</span> =</span> &amp;node; <span class="comment">// 指针指向栈上的本体</span></span><br><span class="line">head-&gt;data = <span class="number">10</span>; <span class="comment">// 此时可用，因为指针指向了有效内存</span></span><br></pre></td></tr></table></figure><p>但这种写法的核心局限是：栈内存的生命周期仅限于当前作用域。比如跨函数使用时，问题就暴露了：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误示例：返回栈上的指针</span></span><br><span class="line"><span class="keyword">struct</span> Node* <span class="title function_">createNode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> <span class="title">node</span>;</span> <span class="comment">// 栈上的节点，函数结束后立即销毁</span></span><br><span class="line">    node.data = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">return</span> &amp;node; <span class="comment">// 返回栈地址，函数结束后该地址失效</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">head</span> =</span> createNode();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, head-&gt;data); <span class="comment">// 未定义行为：可能输出乱码/崩溃</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>栈内存由系统自动管理，函数执行完毕后，栈上的node会被销毁，返回的指针就成了“野指针”，后续操作完全不可靠。</p><p>写法 2：全局 / 静态结构体实例（更不推荐）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> <span class="title">node</span>;</span> <span class="comment">// 全局变量，内存在全局区（非栈/堆）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">head</span> =</span> &amp;node;</span><br></pre></td></tr></table></figure><p>全局变量的生命周期是整个程序，但缺点致命：</p><ul><li>内存一直占用，无法手动释放；</li><li>全局变量会导致代码耦合度高、线程不安全，完全失去 “动态创建 / 销毁”的灵活性。</li></ul><h3 id="malloc-的核心价值为-节点本体-分配堆内存">2.3 malloc的核心价值：为 “节点本体” 分配堆内存</h3><p>malloc(sizeof(struct Node)) 的作用是在堆内存中创建“节点数据本体”，再让指针指向这个本体：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">head</span> =</span> (<span class="keyword">struct</span> Node*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> Node));</span><br></pre></td></tr></table></figure><h3 id="总结为什么不能-只定义指针">2.4 总结：为什么不能“只定义指针”？</h3><ol type="1"><li><code>struct Node* head;</code> 只是 “空指针壳”：指针本身是个“地址容器”，但容器里装的是随机地址，没有对应的“节点数据本体”，根本无法操作；</li><li>直接定义栈上的节点（<code>struct Node node;</code>）有生命周期限制：仅适合局部临时使用，无法作为动态数据结构（如链表）的节点（链表需要节点长期存在、跨函数访问）；</li><li><code>malloc</code>才是动态数据结构的刚需：链表、树等结构的节点数量是运行时动态变化的（比如随时增删节点），堆内存的“手动管理生命周期” 特性，是实现这类结构的核心基础。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;用C语言实现贪吃蛇游戏过程中，定义蛇身节点是用到了结构体和指针。&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 蛇身节点结构体，用于存储每个蛇身段的位置坐标&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Node&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; x;  &lt;span class=&quot;comment&quot;&gt;// x坐标&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; y;  &lt;span class=&quot;comment&quot;&gt;// y坐标&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Node&lt;/span&gt;* &lt;span class=&quot;title&quot;&gt;next&lt;/span&gt;;&lt;/span&gt;  &lt;span class=&quot;comment&quot;&gt;// 指向下一个节点的指针&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在函数中定义蛇身（头部）节点时，我第一个想法是这样定义
&lt;code&gt;struct Node *head&lt;/code&gt;，但实际上完整的写法是
&lt;code&gt;struct Node *head = (struct Node*)malloc(sizeof(struct Node));&lt;/code&gt;。那么就要探究这两个写法的不同。&lt;/p&gt;
    
    </summary>
    
    
      <category term="代码人生" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="c programming" scheme="http://yoursite.com/tags/c-programming/"/>
    
      <category term="pointer" scheme="http://yoursite.com/tags/pointer/"/>
    
  </entry>
  
  <entry>
    <title>WARNING: The requested image&#39;s platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested</title>
    <link href="http://yoursite.com/2024/12/28/WARNING-The-requested-image-s-platform-linux-amd64-does-not-match-the-detected-host-platform-linux-arm64-v8-and-no-specific-platform-was-requested/"/>
    <id>http://yoursite.com/2024/12/28/WARNING-The-requested-image-s-platform-linux-amd64-does-not-match-the-detected-host-platform-linux-arm64-v8-and-no-specific-platform-was-requested/</id>
    <published>2024-12-28T08:44:57.000Z</published>
    <updated>2025-10-28T08:54:39.552Z</updated>
    
    <content type="html"><![CDATA[<p>当前我就遇到了这样的问题。我在Raspberry Pi 4B开发板上安装了Docker，使用命令<code>sudo docker run --platform linux/amd64 -p 12000:80     -e PAPERMERGE__SECURITY__SECRET_KEY=abc     -e PAPERMERGE__AUTH__PASSWORD=admin     papermerge/papermerge:3.0.3</code>安装papermerge的应用，但是镜像在下载完成后，启动容器失败。</p><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~ $ sudo docker run -p 12000:80 \</span><br><span class="line">    -e PAPERMERGE__SECURITY__SECRET_KEY=abc \</span><br><span class="line">    -e PAPERMERGE__AUTH__PASSWORD=admin \</span><br><span class="line">    papermerge/papermerge:3.0.3</span><br><span class="line">Unable to find image &#x27;papermerge/papermerge:3.0.3&#x27; locally</span><br><span class="line">3.0.3: Pulling from papermerge/papermerge</span><br><span class="line">1b13d4e1a46e: Pull complete</span><br><span class="line">1c74526957fc: Pull complete</span><br><span class="line">30d855997954: Pull complete</span><br><span class="line">ad5739181616: Pull complete</span><br><span class="line">75e2b45cbee5: Pull complete</span><br><span class="line">37a8a17eedd2: Pull complete</span><br><span class="line">2697e3bb938f: Pull complete</span><br><span class="line">1db75c2e70ec: Pull complete</span><br><span class="line">58505172c2e6: Pull complete</span><br><span class="line">0a775f2002be: Pull complete</span><br><span class="line">37fb7305149c: Pull complete</span><br><span class="line">02037e26ac8b: Pull complete</span><br><span class="line">4f4fb700ef54: Pull complete</span><br><span class="line">9653d7ced0f6: Pull complete</span><br><span class="line">bd12b98793c3: Pull complete</span><br><span class="line">47f6b2bc5bac: Pull complete</span><br><span class="line">9f141d238019: Pull complete</span><br><span class="line">602ce056b6d8: Pull complete</span><br><span class="line">5e02c83b56e1: Pull complete</span><br><span class="line">4fe8b167f5a3: Pull complete</span><br><span class="line">ea4243bd0db9: Pull complete</span><br><span class="line">389b5952531d: Pull complete</span><br><span class="line">56f42d775b8f: Pull complete</span><br><span class="line">2dc53ec46535: Pull complete</span><br><span class="line">4a4c9786a7f0: Pull complete</span><br><span class="line">5125d1a6bc0c: Pull complete</span><br><span class="line">332a8c2009c8: Pull complete</span><br><span class="line">21bb079de5bc: Pull complete</span><br><span class="line">Digest: sha256:8849807ab74ee0dba54ea7db3dfa843da7d8fdaa7f6f5924a15f393149457925</span><br><span class="line">Status: Downloaded newer image for papermerge/papermerge:3.0.3</span><br><span class="line">WARNING: The requested image&#x27;s platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested</span><br><span class="line">exec /run.bash: exec format error</span><br><span class="line">pi@raspberrypi:~ $</span><br></pre></td></tr></table></figure><p>一直认为，只要保证 Docker安装好，从Docker仓库上Pull下来的镜像，在任意机器上运行都能达到一样的效果，但是这个的前提是Docker镜像的架构和当前服务器的架构一致，以前都是x84_64架构自然可以，但现在也有别的架构，因此 一个镜像如果只有 x86_64架构的版本，那么是无法在 Arm 架构的服务器上运行的。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;当前我就遇到了这样的问题。我在Raspberry Pi 4B
开发板上安装了Docker，使用命令&lt;code&gt;sudo docker run --platform linux/amd64 -p 12000:80     -e PAPERMERGE__SECURITY__SECRET_KEY=abc     -e PAPERMERGE__AUTH__PASSWORD=admin     papermerge/papermerge:3.0.3&lt;/code&gt;安装papermerge的应用，但是镜像在下载完成后，启动容器失败。&lt;/p&gt;
    
    </summary>
    
    
      <category term="折腾" scheme="http://yoursite.com/categories/%E6%8A%98%E8%85%BE/"/>
    
    
      <category term="raspberrypi" scheme="http://yoursite.com/tags/raspberrypi/"/>
    
      <category term="docker" scheme="http://yoursite.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Tomcat10.1.x使用JSTL标签库</title>
    <link href="http://yoursite.com/2024/11/15/Tomcat10-1-x%E4%BD%BF%E7%94%A8JSTL%E6%A0%87%E7%AD%BE%E5%BA%93/"/>
    <id>http://yoursite.com/2024/11/15/Tomcat10-1-x%E4%BD%BF%E7%94%A8JSTL%E6%A0%87%E7%AD%BE%E5%BA%93/</id>
    <published>2024-11-15T07:23:52.000Z</published>
    <updated>2024-11-15T08:30:29.382Z</updated>
    
    <content type="html"><![CDATA[<p>IDEA创建Java EE项目，使用Spring + Spring MVC +MyBatis框架，使用maven管理依赖。项目当前的环境是：</p><ul><li>Tomat 10.1.28</li><li>Maven 3.6.3</li><li>JDK 17</li></ul><p>项目的功能：读取数据库的report表中的数据，返回一个List集合对象<code>reportList</code>在JSP页面上，使用EL表达式+JSTL标签库，遍历集合，显示每一条report信息。</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;首页&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h3&gt;欢迎登录，$&#123;sessionScope.get(<span class="string">&quot;user&quot;</span>).name&#125;&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;table&gt;</span><br><span class="line">            &lt;c:forEach items=<span class="string">&quot;$&#123;reportList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;report&quot;</span>&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;报告编号：&lt;/td&gt;&lt;td&gt;$&#123;report.id&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;报告名称：&lt;/td&gt;&lt;td&gt;$&#123;report.reportName&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;报告内容：&lt;/td&gt;&lt;td&gt;$&#123;report.reportContext&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;报告截止提交日期：&lt;/td&gt;&lt;td&gt;$&#123;report.deadlineTime&#125;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/c:forEach&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><span id="more"></span><p>EL表达式和JSTL标签的使用，需要再项目的pom.xml文件引入了一下依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/jstl --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/taglibs/standard --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>因为还需要使用<code>HttpServletRequest</code>对象，并且Tomcat版本是<code>Tomcat10.1.28</code>版本，所以项目的pom.xml增加了<code>jakarta.servlet-api</code>的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>运行后，出现下面这样的报错：</p><blockquote><p>java.lang.ClassNotFoundException:javax.servlet.jsp.tagext.TagLibraryValidator</p></blockquote><p><imgsrc="https://img.picgo.net/2024/11/15/_20241115143734fb310f83e14d9209.jpeg" /></p><p>针对错误，去搜索了相关的解决办法，发现<code>javax.servlet.jstl</code>也不再符合Tomcat10版本的需求，需要使用<code>jakarta.servlet.jsp.jstl-api</code>版本，所以更改了pom.xml的依赖引用：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--https://mvnrepository.com/artifact/jakarta.servlet.jsp.jstl/jakarta.servlet.jsp.jstl-api--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet.jsp.jstl-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/taglibs/standard --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>结果运行还是报同样的错误。</p><p>最终在stackoverflow上找到了一篇文章<ahref="https://stackoverflow.com/questions/8021370/java-lang-noclassdeffounderror-javax-servlet-jsp-tagext-taglibraryvalidator">https://stackoverflow.com/questions/8021370/java-lang-noclassdeffounderror-javax-servlet-jsp-tagext-taglibraryvalidator</a></p><blockquote><p>The javax.servlet.jsp.tagext.TagLibraryValidator class is introducedin JSP 2.0 and then later repackaged tojakarta.servlet.jsp.tagext.TagLibraryValidator in JSP 3.0. This errorcan thus have the following possible causes:</p><p>javax.servlet.jsp.tagext.TagLibraryValidator 类是在 JSP 2.0中引入的，后来在 JSP 3.0 中重新打包为jakarta.servlet.jsp.tagext.TagLibraryValidator。因此，此错误可能有以下可能的原因:</p><ol type="1"><li>You are not running a JSP 2.0 compatible servletcontainer. Forexample, Tomcat 4.x or 5.0. You need a Tomcat version between 5.5 and9.0.</li></ol><p>您没有运行与 JSP 2.0 兼容的 servletcontainer。例如，Tomcat 4.x 或5.0。您需要 5.5 到 9.0 之间的 Tomcat 版本。</p><ol start="2" type="1"><li>You are actually running a JSP 3.0 compatible servletcontainer (thefirst version with jakarta package instead of javax) such as Tomcat 10.0or newer. In that case you'll need to upgrade JSTL from 1.x to 2.0 ornewer. Installation instructions can be found in How to install JSTL? Itfails with "The absolute uri cannot be resolved" or "Unable to findtaglib" or NoClassDefFoundError or ClassCastException.</li></ol><p>您实际上正在运行与 JSP 3.0 兼容的 servletcontainer（第一个使用jakarta 包而不是 javax 的版本），例如 Tomcat 10.0或更新版本。在这种情况下，您需要将 JSTL 从 1.x 升级到 2.0或更新版本.安装说明可以在<ahref="https://stackoverflow.com/questions/4928271/how-to-install-jstl-it-fails-with-the-absolute-uri-cannot-be-resolved-or-una">Howto install JSTL? It fails with "The absolute uri cannot be resolved" or"Unable to find taglib" or NoClassDefFoundError orClassCastException.</a></p><ol start="3" type="1"><li>You have cluttered the /WEB-INF/lib with arbitrarily downloadedjsp-api.jar or j2ee.jar or javaee.jar files or whatever contains the JSPAPI, which originates from a completely different servletcontainermake/version which in turn was actually not JSP 2.0 compliant. Get ridof those libraries. You don't need them. If you did this to workaroundcompilation errors, then you did it the wrong way. They should end up incompiletime classpath, not in the runtime classpath. See also How do Iimport the javax.servlet / jakarta.servlet API in my Eclipseproject?</li></ol><p>您已将任意下载的 jsp-api.jar 或 j2ee.jar 或 javaee.jar 文件或任何包含JSP API 的文件弄得乱七八糟，这些文件来自完全不同的 servletcontainermake/version，而后者实际上并不符合 JSP 2.0标准。删除这些库。您不需要它们。如果您这样做是为了解决编译错误，那么您做错了。它们应该位于编译时类路径中，而不是运行时类路径中。另请参阅<ahref="https://stackoverflow.com/questions/4076601/how-do-i-import-the-javax-servlet-jakarta-servlet-api-in-my-eclipse-project">Howdo I import the javax.servlet / jakarta.servlet API in my Eclipseproject?</a></p></blockquote><p><imgsrc="https://img.picgo.net/2024/11/15/_20241115160000d08964e94b208b02.jpeg" /></p><p>在这个回答中，介绍了另一篇文章<ahref="https://stackoverflow.com/questions/4928271/how-to-install-jstl-it-fails-with-the-absolute-uri-cannot-be-resolved-or-una">Howto install JSTL? It fails with "The absolute uri cannot be resolved" or"Unable to find taglib" or NoClassDefFoundError orClassCastException.</a></p><p><imgsrc="https://img.picgo.net/2024/11/15/_20241115160408f907001b3f920d82.jpeg" /></p><p>所以在pom.xml文件中又增加了<code>jakarta.servlet.jsp.jstl</code>的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--https://mvnrepository.com/artifact/jakarta.servlet.jsp.jstl/jakarta.servlet.jsp.jstl-api--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet.jsp.jstl-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/taglibs/standard --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>重启项目，页面访问数据显示正常。</p><p><imgsrc="https://img.picgo.net/2024/11/15/_20241115160918f4865955a7b38a66.jpeg" /></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;IDEA创建Java EE项目，使用Spring + Spring MVC +
MyBatis框架，使用maven管理依赖。项目当前的环境是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tomat 10.1.28&lt;/li&gt;
&lt;li&gt;Maven 3.6.3&lt;/li&gt;
&lt;li&gt;JDK 17&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;项目的功能：读取数据库的report表中的数据，返回一个List集合对象&lt;code&gt;reportList&lt;/code&gt;在JSP页面上，使用EL表达式+JSTL标签库，遍历集合，显示每一条report信息。&lt;/p&gt;
&lt;figure class=&quot;highlight jsp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;%@ page contentType=&lt;span class=&quot;string&quot;&gt;&amp;quot;text/html;charset=UTF-8&amp;quot;&lt;/span&gt; language=&lt;span class=&quot;string&quot;&gt;&amp;quot;java&amp;quot;&lt;/span&gt; %&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;%@ taglib prefix=&lt;span class=&quot;string&quot;&gt;&amp;quot;c&amp;quot;&lt;/span&gt; uri=&lt;span class=&quot;string&quot;&gt;&amp;quot;http://java.sun.com/jsp/jstl/core&amp;quot;&lt;/span&gt; %&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;meta charset=&lt;span class=&quot;string&quot;&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;title&amp;gt;首页&amp;lt;/title&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;h3&amp;gt;欢迎登录，$&amp;#123;sessionScope.get(&lt;span class=&quot;string&quot;&gt;&amp;quot;user&amp;quot;&lt;/span&gt;).name&amp;#125;&amp;lt;/h3&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;div&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;table&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;lt;c:forEach items=&lt;span class=&quot;string&quot;&gt;&amp;quot;$&amp;#123;reportList&amp;#125;&amp;quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;report&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;lt;tr&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;td&amp;gt;报告编号：&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;$&amp;#123;report.id&amp;#125;&amp;lt;/td&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;td&amp;gt;报告名称：&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;$&amp;#123;report.reportName&amp;#125;&amp;lt;/td&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;td&amp;gt;报告内容：&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;$&amp;#123;report.reportContext&amp;#125;&amp;lt;/td&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;lt;td&amp;gt;报告截止提交日期：&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;$&amp;#123;report.deadlineTime&amp;#125;&amp;lt;/td&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;lt;/tr&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;lt;/c:forEach&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;/table&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;/div&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
    
      <category term="tomcat" scheme="http://yoursite.com/tags/tomcat/"/>
    
      <category term="jstl" scheme="http://yoursite.com/tags/jstl/"/>
    
  </entry>
  
  <entry>
    <title>Minio文件服务器：SpringBoot实现文件上传</title>
    <link href="http://yoursite.com/2024/10/27/Minio%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9ASpringBoot%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <id>http://yoursite.com/2024/10/27/Minio%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9ASpringBoot%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</id>
    <published>2024-10-27T04:40:06.000Z</published>
    <updated>2024-10-28T05:14:42.342Z</updated>
    
    <content type="html"><![CDATA[<p>在Minio文件服务器部署成功后(参考上篇文章《Minio文件服务器：安装]》)接下来我们通过SpringBoot框架写一个接口，来实现文件的上传功能：文件通过SpringBoot接口，上传到Minio文件服务器。并且，如果上传的文件是图片类型，也要实现能够预览上传后的图片。</p><span id="more"></span><h2 id="完成后的项目结构">1 完成后的项目结构</h2><figure><imgsrc="https://img.picgo.net/2024/10/27/_2024102712535402142b0eb619cc1e.jpeg"alt="微信截图 20241027125354" /><figcaption aria-hidden="true">微信截图 20241027125354</figcaption></figure><h2 id="代码">2 代码</h2><h3 id="minioserverapplication.java">2.1MinioserverApplication.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.minioserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.minioserver.config.MinioProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(value = &#123;MinioProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinioserverApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(MinioserverApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="minioproperties.java">2.2 MinioProperties.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.minioserver.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: xbronze</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2024-10-26 17:04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TODO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;minio&quot;)</span> <span class="comment">//读取节点</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinioProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpointUrl;</span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line">    <span class="keyword">private</span> String secreKey;</span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="viewcontenttype.java">2.3 ViewContentType.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.minioserver.enums;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ViewContentType</span> &#123;</span><br><span class="line"></span><br><span class="line">    DEFAULT(<span class="string">&quot;default&quot;</span>,<span class="string">&quot;application/octet-stream&quot;</span>),</span><br><span class="line">    JPG(<span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;image/jpeg&quot;</span>),</span><br><span class="line">    TIFF(<span class="string">&quot;tiff&quot;</span>, <span class="string">&quot;image/tiff&quot;</span>),</span><br><span class="line">    GIF(<span class="string">&quot;gif&quot;</span>, <span class="string">&quot;image/gif&quot;</span>),</span><br><span class="line">    JFIF(<span class="string">&quot;jfif&quot;</span>, <span class="string">&quot;image/jpeg&quot;</span>),</span><br><span class="line">    PNG(<span class="string">&quot;png&quot;</span>, <span class="string">&quot;image/png&quot;</span>),</span><br><span class="line">    TIF(<span class="string">&quot;tif&quot;</span>, <span class="string">&quot;image/tiff&quot;</span>),</span><br><span class="line">    ICO(<span class="string">&quot;ico&quot;</span>, <span class="string">&quot;image/x-icon&quot;</span>),</span><br><span class="line">    JPEG(<span class="string">&quot;jpeg&quot;</span>, <span class="string">&quot;image/jpeg&quot;</span>),</span><br><span class="line">    WBMP(<span class="string">&quot;wbmp&quot;</span>, <span class="string">&quot;image/vnd.wap.wbmp&quot;</span>),</span><br><span class="line">    FAX(<span class="string">&quot;fax&quot;</span>, <span class="string">&quot;image/fax&quot;</span>),</span><br><span class="line">    NET(<span class="string">&quot;net&quot;</span>, <span class="string">&quot;image/pnetvue&quot;</span>),</span><br><span class="line">    JPE(<span class="string">&quot;jpe&quot;</span>, <span class="string">&quot;image/jpeg&quot;</span>),</span><br><span class="line">    RP(<span class="string">&quot;rp&quot;</span>, <span class="string">&quot;image/vnd.rn-realpix&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getContentType</span><span class="params">(String prefix)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isEmpty(prefix))&#123;</span><br><span class="line">            <span class="keyword">return</span> DEFAULT.getType();</span><br><span class="line">        &#125;</span><br><span class="line">        prefix = prefix.substring(prefix.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (ViewContentType value : ViewContentType.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span>(prefix.equalsIgnoreCase(value.getPrefix()))&#123;</span><br><span class="line">                <span class="keyword">return</span> value.getType();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> DEFAULT.getType();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ViewContentType(String prefix, String type) &#123;</span><br><span class="line">        <span class="built_in">this</span>.prefix = prefix;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPrefix</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="fileuploadservice.java">2.4 FileUploadService.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.minioserver.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: xbronze</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2024-10-26 16:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TODO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FileUploadService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fileUpload</span><span class="params">(MultipartFile multipartFile)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="fileuploadserviceimpl.java">2.5 FileUploadServiceImpl.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.minioserver.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.lang.UUID;</span><br><span class="line"><span class="keyword">import</span> com.example.minioserver.config.MinioProperties;</span><br><span class="line"><span class="keyword">import</span> com.example.minioserver.enums.ViewContentType;</span><br><span class="line"><span class="keyword">import</span> com.example.minioserver.service.FileUploadService;</span><br><span class="line"><span class="keyword">import</span> io.minio.BucketExistsArgs;</span><br><span class="line"><span class="keyword">import</span> io.minio.MakeBucketArgs;</span><br><span class="line"><span class="keyword">import</span> io.minio.MinioClient;</span><br><span class="line"><span class="keyword">import</span> io.minio.PutObjectArgs;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: xbronze</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2024-10-26 17:00</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TODO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">FileUploadService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MinioProperties minioProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fileUpload</span><span class="params">(MultipartFile multipartFile)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建一个Minio的客户端对象</span></span><br><span class="line">            <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span> MinioClient.builder()</span><br><span class="line">                    .endpoint(minioProperties.getEndpointUrl())</span><br><span class="line">                    .credentials(minioProperties.getAccessKey(), minioProperties.getSecreKey())</span><br><span class="line">                    .build();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断桶是否存在</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">found</span> <span class="operator">=</span> minioClient.bucketExists(BucketExistsArgs</span><br><span class="line">            .builder()</span><br><span class="line">            .bucket(minioProperties.getBucketName())</span><br><span class="line">            .build());</span><br><span class="line">            <span class="keyword">if</span> (!found) &#123;       <span class="comment">// 如果不存在，那么此时就创建一个新的桶</span></span><br><span class="line">                minioClient.makeBucket(MakeBucketArgs</span><br><span class="line">                .builder()</span><br><span class="line">                .bucket(minioProperties.getBucketName())</span><br><span class="line">                .build());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  <span class="comment">// 如果存在打印信息</span></span><br><span class="line">                System.out.println(<span class="string">&quot;Bucket &quot;</span> </span><br><span class="line">                + minioProperties.getBucketName() </span><br><span class="line">                + <span class="string">&quot; already exists.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置存储对象名称</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">dateDir</span> <span class="operator">=</span> DateUtil.format(<span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;yyyyMMdd&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="comment">//20230801/443e1e772bef482c95be28704bec58a901.jpg</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> dateDir+<span class="string">&quot;/&quot;</span>+uuid+multipartFile.getOriginalFilename();</span><br><span class="line">            System.out.println(fileName);</span><br><span class="line"></span><br><span class="line">            <span class="type">PutObjectArgs</span> <span class="variable">putObjectArgs</span> <span class="operator">=</span> PutObjectArgs.builder()</span><br><span class="line">                    .bucket(minioProperties.getBucketName())</span><br><span class="line">                    .stream(multipartFile.getInputStream(), multipartFile.getSize(), -<span class="number">1</span>)</span><br><span class="line">                    .object(fileName)</span><br><span class="line">                    <span class="comment">// 上传时指定对应对ContentType</span></span><br><span class="line">                    <span class="comment">// Content-Type 用于向接收方说明传输资源的媒体类型，</span></span><br><span class="line">                    <span class="comment">// 从而让浏览器用指定码表去解码。</span></span><br><span class="line">                    .contentType(ViewContentType.getContentType(fileName))</span><br><span class="line">                    .build();</span><br><span class="line">            minioClient.putObject(putObjectArgs) ;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> minioProperties.getEndpointUrl() </span><br><span class="line">            + <span class="string">&quot;/&quot;</span> + minioProperties.getBucketName() </span><br><span class="line">            + <span class="string">&quot;/&quot;</span> + fileName ;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="fileuploadcontroller.java">2.6 FileUploadController.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.minioserver.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.minioserver.service.FileUploadService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: xbronze</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2024-10-26 16:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TODO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FileUploadService fileUploadService ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,String&gt; <span class="title function_">fileUploadService</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam(value = &quot;file&quot;)</span> MultipartFile multipartFile)</span> &#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileUrl</span> <span class="operator">=</span> fileUploadService.fileUpload(multipartFile);</span><br><span class="line">        map.put(<span class="string">&quot;fileurl&quot;</span>,fileUrl);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="application.yml">2.7 application.yml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: minioserver</span><br><span class="line">server:</span><br><span class="line">  port: 8091</span><br><span class="line"></span><br><span class="line"># 部署的minio服务</span><br><span class="line">minio:</span><br><span class="line">  endpointUrl: http://192.168.72.135:9100</span><br><span class="line">  accessKey: admin</span><br><span class="line">  secreKey: admin123</span><br><span class="line">  bucketName: test</span><br></pre></td></tr></table></figure><blockquote><p>Minio文件服务器部署的虚拟就，ip地址是<code>192.168.72.135</code>，因此这里minio服务的访问地址设置为<code>http://192.168.72.135:9100</code>，请根据自己的实际情况进行设置。</p></blockquote><h3 id="pom.xml">2.8 pom.xml</h3><p>这里只展示引入的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.minio/minio --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.minio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>minio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>8.5.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/cn.hutool/hutool-all --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="运行">3 运行</h2><p>访问文件上传接口，选择一张图片上传，接口请求成功后，会返回一个url链接。</p><p><imgsrc="https://img.picgo.net/2024/10/27/_2024102713073412f0d8c029a00a84.jpeg" /></p><p>通过链接可预览上传的图片。</p><p><imgsrc="https://img.picgo.net/2024/10/27/_202410271308198d9786595967d987.jpeg" /></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在Minio文件服务器部署成功后(参考上篇文章《Minio文件服务器：安装]》)接下来我们通过SpringBoot框架写一个接口，来实现文件的上传功能：文件通过SpringBoot接口，上传到Minio文件服务器。并且，如果上传的文件是图片类型，也要实现能够预览上传后的图片。&lt;/p&gt;
    
    </summary>
    
    
      <category term="文件服务器" scheme="http://yoursite.com/categories/%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
      <category term="Spring" scheme="http://yoursite.com/tags/Spring/"/>
    
      <category term="minio" scheme="http://yoursite.com/tags/minio/"/>
    
  </entry>
  
  <entry>
    <title>Minio文件服务器：安装</title>
    <link href="http://yoursite.com/2024/10/26/Minio%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A%E5%AE%89%E8%A3%85/"/>
    <id>http://yoursite.com/2024/10/26/Minio%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A%E5%AE%89%E8%A3%85/</id>
    <published>2024-10-26T10:48:29.000Z</published>
    <updated>2024-10-28T05:12:04.009Z</updated>
    
    <content type="html"><![CDATA[<p>目前，云中有许多文件存储选项，如 Aws S3、Google Storage等。而且，很少有人有预算购买云服务，只是为了在云上保存文件。因此，在本教程中，我们将在Centos 7 上设置 minio 服务器，并设置 Nginx 以安全连接 minio服务器和您的应用程序</p><span id="more"></span><h2 id="安装">安装</h2><p>首先在 Centos 7 上为 minio 添加一些用户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># useradd -s /sbin/nologin -d /opt/minio minio</span><br></pre></td></tr></table></figure><p><imgsrc="https://img.picgo.net/2024/10/26/_20241026160606ebabbfa3555d8f14.jpeg" /></p><p>并为 minio 应用程序和配置文件创建一些文件夹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mkdir -p /opt/minio/bin</span><br></pre></td></tr></table></figure><p><imgsrc="https://img.picgo.net/2024/10/26/_2024102616071144a7aa8997205fae.jpeg" /></p><p>创建文件夹后，现在下载 minio 二进制文件并将其放入我们之前创建的 minio文件夹中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># wget https://dl.minio.io/server/minio/release/linux-amd64/minio -O /opt/minio/bin/minio</span><br></pre></td></tr></table></figure><p><imgsrc="https://img.picgo.net/2024/10/26/_20241026161000bd2b7ceaa08ca171.jpeg" /></p><p>修改权限文件以便 minio 二进制文件可以执行 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># chmod +x /opt/minio/bin/minio</span><br></pre></td></tr></table></figure></p><p><imgsrc="https://img.picgo.net/2024/10/26/_2024102616132534159224cdfa9dc8.jpeg" /></p><p>现在我们为minio创建配置文件以便于配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim /opt/minio/minio.conf</span><br></pre></td></tr></table></figure><p>在配置文件中我们放置了端口、访问密钥和密钥等环境信息<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MINIO_VOLUMES=&quot;/var/www/minio_storage/&quot; </span><br><span class="line">MINIO_OPTS=&quot;--address:9100&quot; </span><br><span class="line">MINIO_ACCESS_KEY=admin</span><br><span class="line">MINIO_SECRET_KEY=admin123</span><br></pre></td></tr></table></figure></p><p><imgsrc="https://img.picgo.net/2024/10/26/_202410261615141a2e611bf8cc6138.jpeg" /></p><p>之后我们为 minio存储文件创建一些文件夹，并确保我们使用的路径文件夹与我们放在配置文件(/opt/minio/minio.conf) 上的路径文件夹相同，并将所有者更改为 minio用户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mkdir -p /var/www/minio_storage/ </span><br><span class="line"># chown -R minio:minio /var/www/minio_storage/</span><br></pre></td></tr></table></figure><p><imgsrc="https://img.picgo.net/2024/10/26/_20241026161641e10e03c5213e1575.jpeg" /></p><p>现在我们创建系统文件服务，以便 minio 可以作为后台服务运行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/systemd/system/minio.service</span><br></pre></td></tr></table></figure><p>并将脚本服务放在该文件上，像这样</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Minio</span><br><span class="line">Documentation=https://docs.minio.io</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=network-online.target</span><br><span class="line">AssertFileIsExecutable=/opt/minio/bin/minio</span><br><span class="line"> </span><br><span class="line">[Service]</span><br><span class="line">WorkingDirectory=/opt/minio</span><br><span class="line">User=minio</span><br><span class="line">Group=minio</span><br><span class="line">PermissionsStartOnly=true</span><br><span class="line">EnvironmentFile=-/opt/minio/minio.conf</span><br><span class="line">ExecStartPre=/bin/bash -c &quot;[ -n \&quot;$&#123;MINIO_VOLUMES&#125;\&quot; ] || echo \&quot;Variable MINIO_VOLUMES not set in /opt/minio/minio.conf\&quot;&quot;</span><br><span class="line">ExecStart=/opt/minio/bin/minio server $MINIO_OPTS $MINIO_VOLUMES</span><br><span class="line">StandardOutput=journal</span><br><span class="line">StandardError=inherit</span><br><span class="line"># Specifies the maximum file descriptor number that can be opened by this process</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"># Disable timeout logic and wait until process is stopped</span><br><span class="line">TimeoutStopSec=0</span><br><span class="line"># SIGTERM signal is used to stop Minio</span><br><span class="line">KillSignal=SIGTERM</span><br><span class="line">SendSIGKILL=no</span><br><span class="line">SuccessExitStatus=0</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>使用以下方法在 Centos 7 上重新加载系统守护进程</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl daemon-reload</span><br></pre></td></tr></table></figure><p>现在启动并启用 minio 服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl start minio </span><br><span class="line"># systemctl enable minio</span><br></pre></td></tr></table></figure><p><imgsrc="https://img.picgo.net/2024/10/26/_20241026164329f7deae00ee883032.jpeg" /></p><p>这就是在 Centos 7 上安装和设置 minio 应用程序的方法。</p><h2 id="访问">访问</h2><p>打开浏览器，<code>访问 localhost:9100</code>（或者自己本机的ip:9100）</p><blockquote><p>当访问<code>localhost:9100</code>，minio会自动重定向到<code>localhost:43755</code></p></blockquote><p><imgsrc="https://img.picgo.net/2024/10/26/_20241026164526e6bf5678d438d02f.jpeg" /></p><p>创建一个Bucket</p><p><imgsrc="https://img.picgo.net/2024/10/26/_20241026165243cf915068b7db5b5f.jpeg" /></p><p><imgsrc="https://img.picgo.net/2024/10/26/_20241026165316f9b603218d87209a.jpeg" /></p><p>并且设置访问权限为<code>public</code></p><p><imgsrc="https://img.picgo.net/2024/10/26/_20241026165405a242600d198385d7.jpeg" /></p><h2 id="年10月28日-补充">2024年10月28日 补充：</h2><p><code>/opt/minio/minio.conf</code>的配置中，设置了<code>MINIO_OPTS="--address:9100"</code>，代表MinIO服务的监听端口和Minio服务UI界面的访问端口都是<code>9100</code>，需要注意的是，当在浏览器输入<code>localhost:9100</code>访问Minio服务的UI界面时，Minio服务会通知浏览器重定向到<code>localhost:45750</code>(重定向后的端口号不固定，可能之后的访问会重定向到<code>45755</code>、或者其他端口号)。</p><p><imgsrc="https://img.picgo.net/2024/10/28/_202410281258444ae432a47c278dbd.jpeg" /></p><p>所以可以更改一下<code>/opt/minio/minio.conf</code>的配置，分别设置Minio服务的监听端口和Minio服务UI界面的访问端口.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MINIO_VOLUMES=&quot;/var/www/minio_storage/&quot; </span><br><span class="line">MINIO_OPTS=&quot;--address:9100 --console-address:43755&quot; </span><br><span class="line">MINIO_ACCESS_KEY=admin</span><br><span class="line">MINIO_SECRET_KEY=admin123</span><br></pre></td></tr></table></figure><p>重启minio应用，再次访问<code>localhost:9100</code>，浏览器会固定重定向到<code>localhost:43755</code>，并且之后不管什么时候再次访问，重定向后端的端口一直会是<code>43755</code></p><p><imgsrc="https://img.picgo.net/2024/10/28/_2024102813102977d819dd54719606.jpeg" /></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;目前，云中有许多文件存储选项，如 Aws S3、Google Storage
等。而且，很少有人有预算购买云服务，只是为了在云上保存文件。因此，在本教程中，我们将在
Centos 7 上设置 minio 服务器，并设置 Nginx 以安全连接 minio
服务器和您的应用程序&lt;/p&gt;
    
    </summary>
    
    
      <category term="文件服务器" scheme="http://yoursite.com/categories/%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
      <category term="mini" scheme="http://yoursite.com/tags/mini/"/>
    
  </entry>
  
  <entry>
    <title>Arrays.binarySearch()方法详解</title>
    <link href="http://yoursite.com/2023/09/05/Arrays-binarySearch-%E6%96%B9%E6%B3%95%E8%AF%A6%E8%A7%A3/"/>
    <id>http://yoursite.com/2023/09/05/Arrays-binarySearch-%E6%96%B9%E6%B3%95%E8%AF%A6%E8%A7%A3/</id>
    <published>2023-09-05T09:14:19.000Z</published>
    <updated>2023-11-01T06:41:15.416Z</updated>
    
    <content type="html"><![CDATA[<p>背景：我想校验一个指定的String字符串，是否存在于另一个String数组中，选择<code>Arrays.binarySearch()</code>方法实现，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String[] item = &#123;<span class="string">&quot;0&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;16&quot;</span>,<span class="string">&quot;1591&quot;</span>,<span class="string">&quot;1594&quot;</span>,<span class="string">&quot;1596&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">if</span> (Arrays.binarySearch(item, <span class="string">&quot;1591&quot;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;exists&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;not exists&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">not exists</span><br></pre></td></tr></table></figure><p>很直观的能看到item数组里面存在字符串<code>1591</code>，为什么程序运行的结果却是找不到该元素呢？</p><span id="more"></span><p>首先来看一下源码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Searches the specified array for the specified object using the binary</span></span><br><span class="line"><span class="comment"> * search algorithm. The array must be sorted into ascending order</span></span><br><span class="line"><span class="comment"> * according to the</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@linkplain</span> Comparable natural ordering&#125;</span></span><br><span class="line"><span class="comment"> * of its elements (as by the</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #sort(Object[])&#125; method) prior to making this call.</span></span><br><span class="line"><span class="comment"> * If it is not sorted, the results are undefined.</span></span><br><span class="line"><span class="comment"> * (If the array contains elements that are not mutually comparable (for</span></span><br><span class="line"><span class="comment"> * example, strings and integers), it &lt;i&gt;cannot&lt;/i&gt; be sorted according</span></span><br><span class="line"><span class="comment"> * to the natural ordering of its elements, hence results are undefined.)</span></span><br><span class="line"><span class="comment"> * If the array contains multiple</span></span><br><span class="line"><span class="comment"> * elements equal to the specified object, there is no guarantee which</span></span><br><span class="line"><span class="comment"> * one will be found.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a the array to be searched</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the value to be searched for</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> index of the search key, if it is contained in the array;</span></span><br><span class="line"><span class="comment"> *         otherwise, &lt;tt&gt;(-(&lt;i&gt;insertion point&lt;/i&gt;) - 1)&lt;/tt&gt;.  The</span></span><br><span class="line"><span class="comment"> *         &lt;i&gt;insertion point&lt;/i&gt; is defined as the point at which the</span></span><br><span class="line"><span class="comment"> *         key would be inserted into the array: the index of the first</span></span><br><span class="line"><span class="comment"> *         element greater than the key, or &lt;tt&gt;a.length&lt;/tt&gt; if all</span></span><br><span class="line"><span class="comment"> *         elements in the array are less than the specified key.  Note</span></span><br><span class="line"><span class="comment"> *         that this guarantees that the return value will be &amp;gt;= 0 if</span></span><br><span class="line"><span class="comment"> *         and only if the key is found.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ClassCastException if the search key is not comparable to the</span></span><br><span class="line"><span class="comment"> *         elements of the array.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(Object[] a, Object key)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> binarySearch0(a, <span class="number">0</span>, a.length, key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意，注释上提到了两个重点：</p><ol type="1"><li>使用二分查找算法在指定数组中搜索指定对象；</li><li>在调用此方法之前，必须根据元素的自然顺序(如通过sort(Object[])方法)将数组按升序排序。</li></ol><p>也就是说，数组不是遍历每一个元素，与目标值做对比，校验是否相同，而是通过二分查找算法，先找到数组中间的元素，与目标值做比较：如果目标值大于中间值，则继续比较数组后半部分的元素；如果目标值小于中间值，则继续比较数组前半部分的元素；如果等于，那么就直接返回中间元素的数组下标。因此在调用此方法之前，要先对数组进行升序排序。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch0</span><span class="params">(Object[] a, <span class="type">int</span> fromIndex, <span class="type">int</span> toIndex,</span></span><br><span class="line"><span class="params">                                     Object key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> fromIndex;</span><br><span class="line">    <span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> toIndex - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (low &lt;= high) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (low + high) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;rawtypes&quot;)</span></span><br><span class="line">        <span class="type">Comparable</span> <span class="variable">midVal</span> <span class="operator">=</span> (Comparable)a[mid];</span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">cmp</span> <span class="operator">=</span> midVal.compareTo(key);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">            high = mid - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> mid; <span class="comment">// key found</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -(low + <span class="number">1</span>);  <span class="comment">// key not found.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>源码中，是中间值通过<code>(low + high) &gt;&gt;&gt; 1</code>的方式获取的。</p><p>这是一个在二分查找算法中常见的代码片段。low 和 high通常表示搜索范围的下界和上界。mid 是下界和上界的中间值，通过 (low +high) &gt;&gt;&gt; 1 计算得出。</p><p>这是由于在Java中，+运算符对于整数是按照整数算术运算（即舍去小数点）来执行的。这可能会导致整数的溢出。例如，如果low 是 -1000000000，而 high 是 1000000000，那么 low + high 的结果将会是-999999999 + 1000000000，这将导致整数溢出。</p><p>而使用&gt;&gt;&gt;（无符号右移运算符）则可以避免这个问题。位运算中，右移运算符&gt;&gt;对于负数会将移位后的左侧填充部分填充为该数的符号位（即负数的话填充为1，正数的话填充为0）。而&gt;&gt;&gt;是无符号右移运算符，无论该数是正数还是负数，都会将左侧填充部分填充为0。</p><p>所以 (low + high) &gt;&gt;&gt; 1 的结果就是 low + high的值除以2的整数部分，无论 low 和 high 的值是多少。</p><p>拿到数组的中间元素后，通过<code>int cmp = midVal.compareTo(key)</code>的方法比较中间元素和目标值。</p><p>compareTo() 方法按字典顺序比较两个字符串（比较基于字符串中每个字符的Unicode 值）。</p><p>接下来回到最开始的问题中，通过调试发现，中间元素<code>16</code>与目标值<code>1591</code>比较，结果cmp=1，也就是说比较的结果居然是<code>16</code>大于<code>1591</code>。</p><img src="/2023/09/05/Arrays-binarySearch-%E6%96%B9%E6%B3%95%E8%AF%A6%E8%A7%A3/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230905182124.png" class=""><p>由于比较的结果大于0，因此<code>mid-1</code>，接下来会拿数组左边部分的值与目标值做对比，而<code>16</code>左边的几个元素不存在<code>1591</code>，因此最终结果是在数组中找不到与目标值一致的元素。</p><p>这是因为，<code>16</code>和<code>1591</code>都是字符串类型，而非数值类型，字符串类型通过<code>compareTo()</code>方法进行比较，是比较两个字符串相应位置字符的Unicode值。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Compares two strings lexicographically.</span></span><br><span class="line"><span class="comment"> * The comparison is based on the Unicode value of each character in</span></span><br><span class="line"><span class="comment"> * the strings. The character sequence represented by this</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> String&#125; object is compared lexicographically to the</span></span><br><span class="line"><span class="comment"> * character sequence represented by the argument string. The result is</span></span><br><span class="line"><span class="comment"> * a negative integer if this &#123;<span class="doctag">@code</span> String&#125; object</span></span><br><span class="line"><span class="comment"> * lexicographically precedes the argument string. The result is a</span></span><br><span class="line"><span class="comment"> * positive integer if this &#123;<span class="doctag">@code</span> String&#125; object lexicographically</span></span><br><span class="line"><span class="comment"> * follows the argument string. The result is zero if the strings</span></span><br><span class="line"><span class="comment"> * are equal; &#123;<span class="doctag">@code</span> compareTo&#125; returns &#123;<span class="doctag">@code</span> 0&#125; exactly when</span></span><br><span class="line"><span class="comment"> * the &#123;<span class="doctag">@link</span> #equals(Object)&#125; method would return &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * This is the definition of lexicographic ordering. If two strings are</span></span><br><span class="line"><span class="comment"> * different, then either they have different characters at some index</span></span><br><span class="line"><span class="comment"> * that is a valid index for both strings, or their lengths are different,</span></span><br><span class="line"><span class="comment"> * or both. If they have different characters at one or more index</span></span><br><span class="line"><span class="comment"> * positions, let &lt;i&gt;k&lt;/i&gt; be the smallest such index; then the string</span></span><br><span class="line"><span class="comment"> * whose character at position &lt;i&gt;k&lt;/i&gt; has the smaller value, as</span></span><br><span class="line"><span class="comment"> * determined by using the &amp;lt; operator, lexicographically precedes the</span></span><br><span class="line"><span class="comment"> * other string. In this case, &#123;<span class="doctag">@code</span> compareTo&#125; returns the</span></span><br><span class="line"><span class="comment"> * difference of the two character values at position &#123;<span class="doctag">@code</span> k&#125; in</span></span><br><span class="line"><span class="comment"> * the two string -- that is, the value:</span></span><br><span class="line"><span class="comment"> * &lt;blockquote&gt;&lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * this.charAt(k)-anotherString.charAt(k)</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;&lt;/blockquote&gt;</span></span><br><span class="line"><span class="comment"> * If there is no index position at which they differ, then the shorter</span></span><br><span class="line"><span class="comment"> * string lexicographically precedes the longer string. In this case,</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> compareTo&#125; returns the difference of the lengths of the</span></span><br><span class="line"><span class="comment"> * strings -- that is, the value:</span></span><br><span class="line"><span class="comment"> * &lt;blockquote&gt;&lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * this.length()-anotherString.length()</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;&lt;/blockquote&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>   anotherString   the &#123;<span class="doctag">@code</span> String&#125; to be compared.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  the value &#123;<span class="doctag">@code</span> 0&#125; if the argument string is equal to</span></span><br><span class="line"><span class="comment"> *          this string; a value less than &#123;<span class="doctag">@code</span> 0&#125; if this string</span></span><br><span class="line"><span class="comment"> *          is lexicographically less than the string argument; and a</span></span><br><span class="line"><span class="comment"> *          value greater than &#123;<span class="doctag">@code</span> 0&#125; if this string is</span></span><br><span class="line"><span class="comment"> *          lexicographically greater than the string argument.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(String anotherString)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len1</span> <span class="operator">=</span> value.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len2</span> <span class="operator">=</span> anotherString.value.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">lim</span> <span class="operator">=</span> Math.min(len1, len2);</span><br><span class="line">    <span class="type">char</span> v1[] = value;</span><br><span class="line">    <span class="type">char</span> v2[] = anotherString.value;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (k &lt; lim) &#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c1</span> <span class="operator">=</span> v1[k];</span><br><span class="line">        <span class="type">char</span> <span class="variable">c2</span> <span class="operator">=</span> v2[k];</span><br><span class="line">        <span class="keyword">if</span> (c1 != c2) &#123;</span><br><span class="line">            <span class="keyword">return</span> c1 - c2;</span><br><span class="line">        &#125;</span><br><span class="line">        k++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> len1 - len2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>引申：但是要注意的是，这只适用于两个字符都属于基本字母或数字的情况。如果字符包含其他字符（比如特殊字符、标点符号等），或者涉及非数字字符，那么结果可能不会如你所预期。例如，如果'A'和'中'（Unicode值为65296）进行相减，结果将会是-38321，这显然不是我们期望的结果。因此，在进行这种操作时，一定要确保字符的取值范围和你的预期相符。</p></blockquote><p>至此，文章开头 <code>1591</code>为什么在目标数组中<code>&#123;"0","1","16","1591","1594","1596"&#125;</code>匹配不到的问题，原因就是如此。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;背景：我想校验一个指定的String字符串，是否存在于另一个String数组中，选择&lt;code&gt;Arrays.binarySearch()&lt;/code&gt;方法实现，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;String[] item = &amp;#123;&lt;span class=&quot;string&quot;&gt;&amp;quot;0&amp;quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&amp;quot;16&amp;quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&amp;quot;1591&amp;quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&amp;quot;1594&amp;quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&amp;quot;1596&amp;quot;&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Arrays.binarySearch(item, &lt;span class=&quot;string&quot;&gt;&amp;quot;1591&amp;quot;&lt;/span&gt;) &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    System.out.println(&lt;span class=&quot;string&quot;&gt;&amp;quot;exists&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    System.out.println(&lt;span class=&quot;string&quot;&gt;&amp;quot;not exists&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;运行结果：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;not exists&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;很直观的能看到item数组里面存在字符串&lt;code&gt;1591&lt;/code&gt;，为什么程序运行的结果却是找不到该元素呢？&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>泛型以及如何绕过泛型定义</title>
    <link href="http://yoursite.com/2023/08/28/%E6%B3%9B%E5%9E%8B%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E7%BB%95%E8%BF%87%E6%B3%9B%E5%9E%8B%E5%AE%9A%E4%B9%89/"/>
    <id>http://yoursite.com/2023/08/28/%E6%B3%9B%E5%9E%8B%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E7%BB%95%E8%BF%87%E6%B3%9B%E5%9E%8B%E5%AE%9A%E4%B9%89/</id>
    <published>2023-08-28T08:50:01.000Z</published>
    <updated>2023-08-28T08:59:09.230Z</updated>
    
    <content type="html"><![CDATA[<h1 id="泛型定义以及其带来的好处">泛型定义以及其带来的好处</h1><p>泛型使类型（类和接口）能够在定义类、接口和方法时成为参数。与方法声明中使用的更熟悉的形式参数非常相似，类型参数为您提供了一种通过不同输入重复使用相同代码的方法。区别在于形式参数的输入是值，而类型参数的输入是类型。</p><p>使用泛型的代码比非泛型代码有很多好处：</p><ol type="1"><li>编译时更强的类型检查。 Java编译器对泛型代码应用强类型检查，如果代码违反类型安全，则会发出错误。修复编译时错误比修复运行时错误更容易，后者很难发现。</li></ol><span id="more"></span><ol start="2" type="1"><li>避免类型转换</li></ol><p>以下没有泛型的代码片段需要强制转换：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">list.add(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> (String) list.get(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>当重写为使用泛型时，代码不需要转换：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">list.add(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> list.get(<span class="number">0</span>);   <span class="comment">// no cast</span></span><br></pre></td></tr></table></figure><ol start="3" type="1"><li>使程序员能够实现通用算法。通过使用泛型，程序员可以实现适用于不同类型集合的泛型算法，可以自定义，并且类型安全且更易于阅读。</li></ol><h1 id="绕过泛型定义">绕过泛型定义</h1><p>使用反射</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">    <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.util.ArrayList&quot;</span>);</span><br><span class="line">    <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;add&quot;</span>, Object.class);</span><br><span class="line">    method.invoke(list, <span class="number">123</span>);</span><br><span class="line">    System.out.println(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[aa, bb, 123]</span><br></pre></td></tr></table></figure><p>注意：</p><p>如果通过循环遍历输出list的元素，比如</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(String str : list) &#123;</span><br><span class="line">System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.stream().forEach(p -&gt; System.out.println(p));</span><br></pre></td></tr></table></figure><p>就会报错：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">aa</span><br><span class="line">bb</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.String</span><br><span class="line">at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)</span><br><span class="line">at java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:580)</span><br><span class="line">at com.springcloud.business.controller.BusinessController.main(BusinessController.java:45)</span><br></pre></td></tr></table></figure><p>这是因为遍历的时候，会把集合里的元素拿出来，作为泛型定义的<code>String</code>类型输出，而我们通过反射添加了一个<code>Integer</code>类型的值，因此造成类型转换错误。</p><p>除非我们这样遍历输出：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(Object str : list) &#123;</span><br><span class="line">System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aa</span><br><span class="line">bb</span><br><span class="line">123</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;泛型定义以及其带来的好处&quot;&gt;泛型定义以及其带来的好处&lt;/h1&gt;
&lt;p&gt;泛型使类型（类和接口）能够在定义类、接口和方法时成为参数。与方法声明中使用的更熟悉的形式参数非常相似，类型参数为您提供了一种通过不同输入重复使用相同代码的方法。区别在于形式参数的输入是值，而类型参数的输入是类型。&lt;/p&gt;
&lt;p&gt;使用泛型的代码比非泛型代码有很多好处：&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;编译时更强的类型检查。 Java
编译器对泛型代码应用强类型检查，如果代码违反类型安全，则会发出错误。修复编译时错误比修复运行时错误更容易，后者很难发现。&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="代码人生" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="泛型" scheme="http://yoursite.com/tags/%E6%B3%9B%E5%9E%8B/"/>
    
  </entry>
  
  <entry>
    <title>判断两个相同类型对象的值是否相等</title>
    <link href="http://yoursite.com/2023/08/25/%E5%88%A4%E6%96%AD%E4%B8%A4%E4%B8%AA%E7%9B%B8%E5%90%8C%E7%B1%BB%E5%9E%8B%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%80%BC%E6%98%AF%E5%90%A6%E7%9B%B8%E7%AD%89/"/>
    <id>http://yoursite.com/2023/08/25/%E5%88%A4%E6%96%AD%E4%B8%A4%E4%B8%AA%E7%9B%B8%E5%90%8C%E7%B1%BB%E5%9E%8B%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%80%BC%E6%98%AF%E5%90%A6%E7%9B%B8%E7%AD%89/</id>
    <published>2023-08-25T07:21:34.000Z</published>
    <updated>2023-08-25T07:55:24.228Z</updated>
    
    <content type="html"><![CDATA[<h1 id="double类型">1.Double类型</h1><p>在Java中，将两个double值转换为String类型，然后使用equals方法进行比较是一个常见的做法，但是这种方法并不是完全可靠，特别是在涉及浮点数的精度时仍然可能会遇到问题。</p><p>浮点数在内部以二进制表示，有时会存在舍入误差，这可能会导致两个在数值上非常接近的浮点数在转换为字符串后变得稍有不同。因此，尽管你可以使用字符串比较来避免直接比较浮点数时的精度问题，但这种方法并不是绝对可靠的。</p><span id="more"></span><p>以下是一个示例，展示了使用字符串比较来判断两个double值是否相等：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoubleStringComparison</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0.1</span> + <span class="number">0.2</span>;</span><br><span class="line">        <span class="type">double</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">0.3</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">xStr</span> <span class="operator">=</span> Double.toString(x);</span><br><span class="line">        <span class="type">String</span> <span class="variable">yStr</span> <span class="operator">=</span> Double.toString(y);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (xStr.equals(yStr)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;They are equal.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;They are not equal.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>虽然这种方法可以避免直接比较浮点数时的精度问题，但是需要注意的是，由于字符串表示法可能会引入额外的舍入或转换误差，因此在某些情况下，仍然可能会得到错误的结果。</p><p>在许多编程语言中，使用浮点数（例如double类型）进行相等性比较时可能会遇到精度问题。由于浮点数的存储方式和精度表示的特性，直接比较两个浮点数是否相等可能会导致意外的结果。因此，在判断两个double类型的值是否相等时，应该使用一些容忍误差的方法。</p><p>一种常见的方法是使用一个很小的阈值（epsilon）来比较两个浮点数的差异，如果它们的差异小于这个阈值，则认为它们是相等的。这个阈值通常取决于你的应用场景和需要的精度。</p><p>以下是一个Java示例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoubleComparison</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">areEqual</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b, <span class="type">double</span> epsilon)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.abs(a - b) &lt; epsilon;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0.1</span> + <span class="number">0.2</span>;</span><br><span class="line">        <span class="type">double</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">0.3</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">double</span> <span class="variable">epsilon</span> <span class="operator">=</span> <span class="number">1e-9</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (areEqual(x, y, epsilon)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;They are equal.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;They are not equal.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>请注意，epsilon的值取决于你的具体情况，你可能需要根据浮点数的大小范围和精度需求来调整这个值。这个方法可以帮助你避免由于浮点数的精度问题而产生的误判。在其他编程语言中也可以使用类似的方法来进行浮点数的相等性比较。</p><h1 id="string类型">2.String类型</h1><p>判断两个字符串是否相同，可用于判断一个字段在逻辑处理前后，值是否有变化。</p><p>其中重点是要考虑两个字符串是否有为null的情况，如果其中一个，或者两个都为空，用<code>str1.equals(str2)</code>直接判断，就会报<code>NullPointerException</code>的错误。</p><p>所以可用采用下面方法进行判断：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">areEqual</span><span class="params">(String str1, String str2)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (str1 == <span class="literal">null</span> &amp;&amp; str2 == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str1 == <span class="literal">null</span> || str2 == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> str1.equals(str2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>如果两个字符串同时为null，可以认为两个字符串是一样的，或者字符串的值没有变化；</li><li>排除两个字符串都为null的情况，如果其中一个字符串为null，那么两个字符串的值就不一致；</li><li>最后在确定两个字符串都不为null，那么就可以使用<code>equals()</code>进行判断。</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;double类型&quot;&gt;1.Double类型&lt;/h1&gt;
&lt;p&gt;在Java中，将两个double值转换为String类型，然后使用equals方法进行比较是一个常见的做法，但是这种方法并不是完全可靠，特别是在涉及浮点数的精度时仍然可能会遇到问题。&lt;/p&gt;
&lt;p&gt;浮点数在内部以二进制表示，有时会存在舍入误差，这可能会导致两个在数值上非常接近的浮点数在转换为字符串后变得稍有不同。因此，尽管你可以使用字符串比较来避免直接比较浮点数时的精度问题，但这种方法并不是绝对可靠的。&lt;/p&gt;
    
    </summary>
    
    
      <category term="代码人生" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="Double - String" scheme="http://yoursite.com/tags/Double-String/"/>
    
  </entry>
  
  <entry>
    <title>MySQL行转列函数</title>
    <link href="http://yoursite.com/2023/08/25/MySQL%E8%A1%8C%E8%BD%AC%E5%88%97%E5%87%BD%E6%95%B0/"/>
    <id>http://yoursite.com/2023/08/25/MySQL%E8%A1%8C%E8%BD%AC%E5%88%97%E5%87%BD%E6%95%B0/</id>
    <published>2023-08-25T07:10:12.000Z</published>
    <updated>2023-08-25T07:25:27.177Z</updated>
    
    <content type="html"><![CDATA[<h1 id="group_concat函数">GROUP_CONCAT()函数</h1><p>创建表<code>person_info</code>，并插入数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> `person_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `family` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">8</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> niffler.person_info (name, family) <span class="keyword">VALUES</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;张三爸&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> niffler.person_info (name, family) <span class="keyword">VALUES</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;张三妈&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> niffler.person_info (name, family) <span class="keyword">VALUES</span>(<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;李四爸&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> niffler.person_info (name, family) <span class="keyword">VALUES</span>(<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;李四妈&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> niffler.person_info (name, family) <span class="keyword">VALUES</span>(<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;李四大哥&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> niffler.person_info (name, family) <span class="keyword">VALUES</span>(<span class="string">&#x27;王二&#x27;</span>, <span class="string">&#x27;王二爷爷&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> niffler.person_info (name, family) <span class="keyword">VALUES</span>(<span class="string">&#x27;王二&#x27;</span>, <span class="string">&#x27;王二姐姐&#x27;</span>);</span><br></pre></td></tr></table></figure><span id="more"></span><table><thead><tr class="header"><th>id</th><th>name</th><th>family</th></tr></thead><tbody><tr class="odd"><td>1</td><td>张三</td><td>张三爸</td></tr><tr class="even"><td>2</td><td>张三</td><td>张三妈</td></tr><tr class="odd"><td>3</td><td>李四</td><td>李四爸</td></tr><tr class="even"><td>4</td><td>李四</td><td>李四妈</td></tr><tr class="odd"><td>5</td><td>李四</td><td>李四大哥</td></tr><tr class="even"><td>6</td><td>王二</td><td>王二爷爷</td></tr><tr class="odd"><td>7</td><td>王二</td><td>王二姐姐</td></tr></tbody></table><p>语法： <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GROUP_CONCAT([<span class="keyword">DISTINCT</span>] expr [,expr ...]</span><br><span class="line">             [<span class="keyword">ORDER</span> <span class="keyword">BY</span> &#123;unsigned_integer <span class="operator">|</span> col_name <span class="operator">|</span> expr&#125;</span><br><span class="line">                 [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>] [,col_name ...]]</span><br><span class="line">             [SEPARATOR str_val])</span><br></pre></td></tr></table></figure></p><p>示例： <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, GROUP_CONCAT(family SEPARATOR <span class="string">&#x27;&amp;&#x27;</span>) <span class="keyword">AS</span> familys <span class="keyword">FROM</span> person_info <span class="keyword">GROUP</span> <span class="keyword">BY</span> name;</span><br></pre></td></tr></table></figure></p><p>结果：</p><img src="/2023/08/25/MySQL%E8%A1%8C%E8%BD%AC%E5%88%97%E5%87%BD%E6%95%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230823102642.png" class=""><p>可以看看我上篇写的关于GROUP_CONCAT()的文章<ahref="https://blog.csdn.net/bronzehammer/article/details/132319248?spm=1001.2014.3001.5501">【笔记】MySQL数据库GROUP_CONCAT()函数输出结果的长度限制</a></p><h1 id="case函数">CASE函数</h1><p>MySQL中的CASE表达式不是行转列函数。它是一种条件表达式，用于根据条件对数据进行选择、计算和转换。</p><p>然而，你可以使用CASE表达式来实现行转列的效果。通过在CASE表达式中定义不同的条件和相应的结果，你可以将行的数据按照不同的条件拆分到不同的列中。</p><p>创建表<code>person_grade</code>，并插入数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `person_grade` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `subject` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `mark` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">5</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> niffler.person_grade (name, subject, mark) <span class="keyword">VALUES</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="number">66</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> niffler.person_grade (name, subject, mark) <span class="keyword">VALUES</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;语文&#x27;</span>, <span class="number">99</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> niffler.person_grade (name, subject, mark) <span class="keyword">VALUES</span>(<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="number">77</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> niffler.person_grade (name, subject, mark) <span class="keyword">VALUES</span>(<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;政治&#x27;</span>, <span class="number">80</span>);</span><br></pre></td></tr></table></figure><table><thead><tr class="header"><th>id</th><th>name</th><th>subject</th><th>mark</th></tr></thead><tbody><tr class="odd"><td>1</td><td>张三</td><td>数学</td><td>66</td></tr><tr class="even"><td>2</td><td>张三</td><td>语文</td><td>99</td></tr><tr class="odd"><td>3</td><td>李四</td><td>数学</td><td>77</td></tr><tr class="even"><td>4</td><td>李四</td><td>政治</td><td>80</td></tr></tbody></table><p>以subject列为表头，展示每个人的成绩</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name , </span><br><span class="line">(<span class="keyword">case</span> subject <span class="keyword">when</span> <span class="string">&#x27;数学&#x27;</span> <span class="keyword">then</span> mark <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;数学&#x27;</span> ,</span><br><span class="line">(<span class="keyword">case</span> subject <span class="keyword">when</span> <span class="string">&#x27;语文&#x27;</span> <span class="keyword">then</span> mark <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;语文&#x27;</span> ,</span><br><span class="line">(<span class="keyword">case</span> subject <span class="keyword">when</span> <span class="string">&#x27;政治&#x27;</span> <span class="keyword">then</span> mark <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;政治&#x27;</span> </span><br><span class="line"><span class="keyword">from</span> person_grade;</span><br></pre></td></tr></table></figure><p>结果</p><img src="/2023/08/25/MySQL%E8%A1%8C%E8%BD%AC%E5%88%97%E5%87%BD%E6%95%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230823132128.png" class=""><p>确实是按照subject列作为表头展示了成绩，但是每条成绩都占用一行，那么如何把同一个人的成绩都在一行展示呢？</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name , </span><br><span class="line"><span class="built_in">MAX</span>(<span class="keyword">case</span> subject <span class="keyword">when</span> <span class="string">&#x27;数学&#x27;</span> <span class="keyword">then</span> mark <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;数学&#x27;</span> ,</span><br><span class="line"><span class="built_in">MAX</span>(<span class="keyword">case</span> subject <span class="keyword">when</span> <span class="string">&#x27;语文&#x27;</span> <span class="keyword">then</span> mark <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;语文&#x27;</span> ,</span><br><span class="line"><span class="built_in">MAX</span>(<span class="keyword">case</span> subject <span class="keyword">when</span> <span class="string">&#x27;政治&#x27;</span> <span class="keyword">then</span> mark <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;政治&#x27;</span> </span><br><span class="line"><span class="keyword">from</span> person_grade</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> name ;</span><br></pre></td></tr></table></figure><p>结果</p><img src="/2023/08/25/MySQL%E8%A1%8C%E8%BD%AC%E5%88%97%E5%87%BD%E6%95%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230823132414.png" class=""><blockquote><p>上面的脚本，把MAX函数换成SUM函数，效果一样；除了CASE函数，也可使用IF函数实现行转列的效果。</p></blockquote><h1id="group_concat和case结合实现动态行转列">GROUP_CONCAT()和CASE()结合实现动态行转列</h1><p>通过CASE()函数的例子可以看到，表头行字段<code>数学</code>、<code>语文</code>、<code>政治</code>都是我们提前已经知晓并且手动指定的，那么如果我们事先不知道有哪些表头字段，怎么办呢？</p><p>可以通过下面的脚本实现：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="variable">@sql</span> <span class="operator">=</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  GROUP_CONCAT(<span class="keyword">DISTINCT</span></span><br><span class="line">    CONCAT(</span><br><span class="line">      <span class="string">&#x27;max(case when subject = &#x27;&#x27;&#x27;</span>,</span><br><span class="line">      subject,</span><br><span class="line">      <span class="string">&#x27;&#x27;&#x27; then mark end) &#x27;</span>,</span><br><span class="line">      subject</span><br><span class="line">    )</span><br><span class="line">  ) <span class="keyword">INTO</span> <span class="variable">@sql</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  Meeting;</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@sql</span> <span class="operator">=</span> CONCAT(<span class="string">&#x27;SELECT Meeting_id, &#x27;</span>, <span class="variable">@sql</span>, <span class="string">&#x27; </span></span><br><span class="line"><span class="string">                  FROM Meeting </span></span><br><span class="line"><span class="string">                   GROUP BY Meeting_id&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">PREPARE</span> stmt <span class="keyword">FROM</span> <span class="variable">@sql</span>;</span><br><span class="line"><span class="keyword">EXECUTE</span> stmt;</span><br><span class="line"><span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> stmt;</span><br><span class="line"></span><br><span class="line"># 定义预处理语句</span><br><span class="line"># <span class="keyword">PREPARE</span> stmt_name <span class="keyword">FROM</span> preparable_stmt;</span><br><span class="line"># 执行预处理语句</span><br><span class="line"># <span class="keyword">EXECUTE</span> stmt_name [<span class="keyword">USING</span> <span class="variable">@var_name</span> [, <span class="variable">@var_name</span>] ...];</span><br><span class="line"># 删除(释放)定义</span><br><span class="line"># &#123;<span class="keyword">DEALLOCATE</span> <span class="operator">|</span> <span class="keyword">DROP</span>&#125; <span class="keyword">PREPARE</span> stmt_name;</span><br></pre></td></tr></table></figure><p>先来看看这句的执行的效果：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  GROUP_CONCAT(<span class="keyword">DISTINCT</span></span><br><span class="line">    CONCAT(</span><br><span class="line">      <span class="string">&#x27;max(case when subject = &#x27;&#x27;&#x27;</span>,</span><br><span class="line">      subject,</span><br><span class="line">      <span class="string">&#x27;&#x27;&#x27; then mark end) as &#x27;</span>,</span><br><span class="line">      subject</span><br><span class="line">    )</span><br><span class="line">  ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  Meeting;</span><br></pre></td></tr></table></figure><p>执行结果： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">max(case when subject = &#x27;政治&#x27; then mark end) as 政治,max(case when subject = &#x27;数学&#x27; then mark end) as 数学,max(case when subject = &#x27;语文&#x27; then mark end) as 语文</span><br></pre></td></tr></table></figure></p><p>是不是已经看出来了，就是为了动态得到行，不是由我们手动指定的，而是通过脚本自动生成、拼接而来。</p><p>然后把拼接后的结果 <code>INTO @sql</code></p><p>再通过</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="variable">@sql</span> <span class="operator">=</span> CONCAT(<span class="string">&#x27;SELECT name, &#x27;</span>, <span class="variable">@sql</span>, <span class="string">&#x27; </span></span><br><span class="line"><span class="string">                  FROM person_grade </span></span><br><span class="line"><span class="string">                   GROUP BY name&#x27;</span>);</span><br></pre></td></tr></table></figure><p>拼成完整的SQL</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name,</span><br><span class="line"><span class="built_in">max</span>(<span class="keyword">case</span> <span class="keyword">when</span> subject <span class="operator">=</span> <span class="string">&#x27;政治&#x27;</span> <span class="keyword">then</span> mark <span class="keyword">end</span>) <span class="keyword">as</span> 政治,</span><br><span class="line"><span class="built_in">max</span>(<span class="keyword">case</span> <span class="keyword">when</span> subject <span class="operator">=</span> <span class="string">&#x27;数学&#x27;</span> <span class="keyword">then</span> mark <span class="keyword">end</span>) <span class="keyword">as</span> 数学,</span><br><span class="line"><span class="built_in">max</span>(<span class="keyword">case</span> <span class="keyword">when</span> subject <span class="operator">=</span> <span class="string">&#x27;语文&#x27;</span> <span class="keyword">then</span> mark <span class="keyword">end</span>) <span class="keyword">as</span> 语文</span><br><span class="line"><span class="keyword">FROM</span> person_grade </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> name</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;group_concat函数&quot;&gt;GROUP_CONCAT()函数&lt;/h1&gt;
&lt;p&gt;创建表&lt;code&gt;person_info&lt;/code&gt;，并插入数据&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;CREATE TABLE&lt;/span&gt; `person_info` (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `id` &lt;span class=&quot;type&quot;&gt;bigint&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;NOT NULL&lt;/span&gt; AUTO_INCREMENT,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `name` &lt;span class=&quot;type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;NULL&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `family` &lt;span class=&quot;type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;NULL&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;PRIMARY KEY&lt;/span&gt; (`id`)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;) ENGINE&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;InnoDB AUTO_INCREMENT&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DEFAULT&lt;/span&gt; CHARSET&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;utf8;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;INSERT INTO&lt;/span&gt; niffler.person_info (name, family) &lt;span class=&quot;keyword&quot;&gt;VALUES&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;张三&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;张三爸&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;INSERT INTO&lt;/span&gt; niffler.person_info (name, family) &lt;span class=&quot;keyword&quot;&gt;VALUES&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;张三&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;张三妈&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;INSERT INTO&lt;/span&gt; niffler.person_info (name, family) &lt;span class=&quot;keyword&quot;&gt;VALUES&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;李四&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;李四爸&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;INSERT INTO&lt;/span&gt; niffler.person_info (name, family) &lt;span class=&quot;keyword&quot;&gt;VALUES&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;李四&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;李四妈&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;INSERT INTO&lt;/span&gt; niffler.person_info (name, family) &lt;span class=&quot;keyword&quot;&gt;VALUES&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;李四&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;李四大哥&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;INSERT INTO&lt;/span&gt; niffler.person_info (name, family) &lt;span class=&quot;keyword&quot;&gt;VALUES&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;王二&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;王二爷爷&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;INSERT INTO&lt;/span&gt; niffler.person_info (name, family) &lt;span class=&quot;keyword&quot;&gt;VALUES&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;王二&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;王二姐姐&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="数据库" scheme="http://yoursite.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="MySQL" scheme="http://yoursite.com/tags/MySQL/"/>
    
      <category term="group_concat" scheme="http://yoursite.com/tags/group-concat/"/>
    
      <category term="行转列" scheme="http://yoursite.com/tags/%E8%A1%8C%E8%BD%AC%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>经典Integer对象赋值128问题</title>
    <link href="http://yoursite.com/2023/08/25/%E7%BB%8F%E5%85%B8Integer%E5%AF%B9%E8%B1%A1%E8%B5%8B%E5%80%BC128%E9%97%AE%E9%A2%98/"/>
    <id>http://yoursite.com/2023/08/25/%E7%BB%8F%E5%85%B8Integer%E5%AF%B9%E8%B1%A1%E8%B5%8B%E5%80%BC128%E9%97%AE%E9%A2%98/</id>
    <published>2023-08-25T03:56:50.000Z</published>
    <updated>2023-08-25T06:59:20.221Z</updated>
    
    <content type="html"><![CDATA[<p>Integer经典面试问题：两个Integer对象都赋值为128，这两个对象比较是否相同？为什么？</p><p>回答这个问题，首先我们要知道，在Java中，当你写<code>Integer a = 1;</code>实际上是调用了Java的自动装箱功能。这会将整数 1自动装箱为Integer对象，然后将这个对象赋值给变量a。</p><p>自动装箱功能是由编译器自动插入的，实际上它相当于执行了如下的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">a</span> <span class="operator">=</span> Integer.valueOf(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>这里的valueOf方法是Integer类的一个静态方法，它的作用就是将传入的参数（通常是基本数据类型）自动转换为对应的包装类对象。对于Integer类来说，就是将整数值转换为Integer对象。</p><span id="more"></span><p>知道这一点之后，我们看看Integer.valueOf方法的源码:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns an &#123;<span class="doctag">@code</span> Integer&#125; instance representing the specified</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> int&#125; value.  If a new &#123;<span class="doctag">@code</span> Integer&#125; instance is not</span></span><br><span class="line"><span class="comment"> * required, this method should generally be used in preference to</span></span><br><span class="line"><span class="comment"> * the constructor &#123;<span class="doctag">@link</span> #Integer(int)&#125;, as this method is likely</span></span><br><span class="line"><span class="comment"> * to yield significantly better space and time performance by</span></span><br><span class="line"><span class="comment"> * caching frequently requested values.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This method will always cache values in the range -128 to 127,</span></span><br><span class="line"><span class="comment"> * inclusive, and may cache other values outside of this range.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  i an &#123;<span class="doctag">@code</span> int&#125; value.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> an &#123;<span class="doctag">@code</span> Integer&#125; instance representing &#123;<span class="doctag">@code</span> i&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span>  1.5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">valueOf</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class="line">        <span class="keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注解上说：如果不需要新的Integer实例，则通常应该优先使用此方法，而不是构造函数Integer(int)，因为通过缓存频繁请求的值，该方法可能会产生更好的空间和时间性能。此方法将始终缓存-128到127(包括-128到127)范围内的值，并可能缓存此范围之外的其他值。</p></blockquote><p>接下来看看IntegerCache缓存的实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Cache to support the object identity semantics of autoboxing for values between</span></span><br><span class="line"><span class="comment"> * -128 and 127 (inclusive) as required by JLS.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The cache is initialized on first usage.  The size of the cache</span></span><br><span class="line"><span class="comment"> * may be controlled by the &#123;<span class="doctag">@code</span> -XX:AutoBoxCacheMax=&lt;size&gt;&#125; option.</span></span><br><span class="line"><span class="comment"> * During VM initialization, java.lang.Integer.IntegerCache.high property</span></span><br><span class="line"><span class="comment"> * may be set and saved in the private system properties in the</span></span><br><span class="line"><span class="comment"> * sun.misc.VM class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">IntegerCache</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> -<span class="number">128</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> high;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Integer cache[];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// high value may be configured by property</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> <span class="number">127</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">integerCacheHighPropValue</span> <span class="operator">=</span></span><br><span class="line">            sun.misc.VM.getSavedProperty(<span class="string">&quot;java.lang.Integer.IntegerCache.high&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (integerCacheHighPropValue != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> parseInt(integerCacheHighPropValue);</span><br><span class="line">                i = Math.max(i, <span class="number">127</span>);</span><br><span class="line">                <span class="comment">// Maximum array size is Integer.MAX_VALUE</span></span><br><span class="line">                h = Math.min(i, Integer.MAX_VALUE - (-low) -<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span>( NumberFormatException nfe) &#123;</span><br><span class="line">                <span class="comment">// If the property cannot be parsed into an int, ignore it.</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        high = h;</span><br><span class="line"></span><br><span class="line">        cache = <span class="keyword">new</span> <span class="title class_">Integer</span>[(high - low) + <span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> low;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; cache.length; k++)</span><br><span class="line">            cache[k] = <span class="keyword">new</span> <span class="title class_">Integer</span>(j++);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// range [-128, 127] must be interned (JLS7 5.1.7)</span></span><br><span class="line">        <span class="keyword">assert</span> IntegerCache.high &gt;= <span class="number">127</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">IntegerCache</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>缓存在第一次使用时初始化。缓存的大小可以通过-XX:AutoBoxCacheMax=<size>选项来控制。在虚拟机初始化过程中，可以设置java.lang.Integer.IntegerCache.high属性，并保存在sun.misc.VM类的私有系统属性中。</p></blockquote><p>IntegerCache缓存范围的最小值固定为-128，最大值默认为127.但是最大值是可以被重新定义的，那么可定义的范围是多少呢？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = Math.max(i, <span class="number">127</span>);</span><br><span class="line"><span class="comment">// Maximum array size is Integer.MAX_VALUE</span></span><br><span class="line">h = Math.min(i, Integer.MAX_VALUE - (-low) -<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>上面的两行已经定义了IntegerCache缓存最大值的范围：</p><ol type="1"><li><p>定义最大值范围大于等于127；</p></li><li><p>定义最大值范围小于等于<code>Integer.MAX_VALUE - (-low) -1</code>;</p></li></ol><p>Integer.MAX_VALUE的定义：（2的23次方 - 1）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Native</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span>   <span class="variable">MAX_VALUE</span> <span class="operator">=</span> <span class="number">0x7fffffff</span>;</span><br></pre></td></tr></table></figure><p>IntegerCache缓存的范围定义好后，为区间范围赋值。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; cache.length; k++)</span><br><span class="line">cache[k] = <span class="keyword">new</span> <span class="title class_">Integer</span>(j++);</span><br></pre></td></tr></table></figure><p>最后通过断言检查 IntegerCache.high 是否大于等于 127。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// range [-128, 127] must be interned (JLS7 5.1.7)</span></span><br><span class="line"><span class="keyword">assert</span> IntegerCache.high &gt;= <span class="number">127</span>;</span><br></pre></td></tr></table></figure><p>IntegerCache.high 是 Java 中 Integer 缓存的一部分，这个缓存用于存储-128 到 127 之间的整数，以提高这个范围内的整数在多次使用时的性能。</p><p><code>assert</code> 是一个用于调试的语句，当 IntegerCache.high &lt;127 时，该语句将抛出 <code>AssertionError</code>。</p><p>JLS7 5.1.7 是 Java Language Specification的一个部分，这部分规定了对于字符串字面值，编译器必须将它们在编译期放入字符串池中，以避免内存浪费。</p><p>这段代码的目的是确保 IntegerCache 的范围在 [-128, 127] 内，因为这是String 缓存这个优化策略可以应用的范围。如果 IntegerCache的范围超出了这个范围，那么可能会导致无法进行这种优化，从而可能降低性能。</p><p>需要注意的是，assert语句在默认情况下是关闭的，如果你想要开启它，需要在启动 JVM 时添加<code>-ea</code>（或 <code>-enableassertions</code>）参数。</p><p>因此，当写 <code>Integer i1 = 128;</code> 和<code>Integer i2 = 128;</code>，实际上在内存中创建了两个不同的对象，即使它们包含相同的值。</p><p>可以通过调用 <code>equals()</code>方法来比较这两个对象的内容是否相同，而不是使用 <code>==</code>运算符。这是因为<code>==</code>在比较对象时实际上是检查它们是否指向内存中的同一个对象，而不是比较它们的内容。而<code>equals()</code> 方法则是比较对象的内容。</p><p>如果使用 <code>equals()</code>方法来比较这两个对象，它们会被视为相等，因为它们包含相同的内容。但是，如果你使用<code>==</code>运算符来比较，它们会被视为不相等，因为它们是不同的对象。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Integer经典面试问题：两个Integer对象都赋值为128，这两个对象比较是否相同？为什么？&lt;/p&gt;
&lt;p&gt;回答这个问题，首先我们要知道，在Java中，当你写&lt;code&gt;Integer a = 1;&lt;/code&gt;
实际上是调用了Java的自动装箱功能。这会将整数 1
自动装箱为Integer对象，然后将这个对象赋值给变量a。&lt;/p&gt;
&lt;p&gt;自动装箱功能是由编译器自动插入的，实际上它相当于执行了如下的代码：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;Integer&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; Integer.valueOf(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里的valueOf方法是Integer类的一个静态方法，它的作用就是将传入的参数（通常是基本数据类型）自动转换为对应的包装类对象。对于Integer类来说，就是将整数值转换为Integer对象。&lt;/p&gt;
    
    </summary>
    
    
      <category term="代码人生" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="Integer" scheme="http://yoursite.com/tags/Integer/"/>
    
  </entry>
  
  <entry>
    <title>【翻译】MySQL数据库InnoDB存储引擎</title>
    <link href="http://yoursite.com/2023/08/24/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/"/>
    <id>http://yoursite.com/2023/08/24/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/</id>
    <published>2023-08-24T12:28:42.000Z</published>
    <updated>2023-08-28T02:30:03.963Z</updated>
    
    <content type="html"><![CDATA[<p>InnoDB is a general-purpose storage engine that balances highreliability and high performance. In MySQL 8.0, InnoDB is the defaultMySQL storage engine. Unless you have configured a different defaultstorage engine, issuing a CREATE TABLE statement without an ENGINEclause creates an InnoDB table.</p><p>InnoDB是一种平衡高可靠性和高性能的通用存储引擎。在MySQL8.0中，InnoDB是MySQL默认的存储引擎。除非您配置了不同的默认存储引擎，否则发出不带ENGINE 子句的 CREATE TABLE 语句将创建一个 InnoDB 表。</p><span id="more"></span><h1 id="key-advantages-of-innodb-innodb的主要优势">Key Advantages ofInnoDB InnoDB的主要优势</h1><p>Its DML operations follow the ACID model, with transactions featuringcommit, rollback, and crash-recovery capabilities to protect userdata.</p><p>其DML操作遵循ACID模型，事务具有提交、回滚和崩溃恢复功能，以保护用户数据</p><p>Row-level locking and Oracle-style consistent reads increasemulti-user concurrency and performance.</p><p>行级锁定和 Oracle 风格的一致性读取提高了多用户并发性和性能</p><p>InnoDB tables arrange your data on disk to optimize queries based onprimary keys. Each InnoDB table has a primary key index called theclustered index that organizes the data to minimize I/O for primary keylookups.</p><p>InnoDB 表在磁盘上排列数据以根据主键优化查询。每个 InnoDB表都有一个称为聚集索引的主键索引，用于组织数据以最大程度地减少主键查找的I/O。</p><p>To maintain data integrity, InnoDB supports FOREIGN KEY constraints.With foreign keys, inserts, updates, and deletes are checked to ensurethey do not result in inconsistencies across related tables</p><p>为了保持数据完整性，InnoDB 支持 FOREIGN KEY约束。使用外键，检查插入、更新和删除，以确保它们不会导致相关表之间的不一致。</p><h1 id="acid">ACID</h1><p>An acronym standing for atomicity, consistency, isolation, anddurability. These properties are all desirable in a database system, andare all closely tied to the notion of a transaction. The transactionalfeatures of InnoDB adhere to the ACID principles.</p><p>ACID代表原子性、一致性、隔离性和持久性的缩写。这些属性都是数据库系统所需要的，并且都与事务的概念密切相关。InnoDB 的事务特性遵循 ACID 原则。</p><p>Transactions are atomic units of work that can be committed or rolledback. When a transaction makes multiple changes to the database, eitherall the changes succeed when the transaction is committed, or all thechanges are undone when the transaction is rolled back.</p><p>事务是可以提交或回滚的原子工作单元。当一个事务对数据库进行多次更改时，要么在事务提交时所有更改都成功，要么在事务回滚时所有更改都被撤消。</p><p>The database remains in a consistent state at all times — after eachcommit or rollback, and while transactions are in progress. If relateddata is being updated across multiple tables, queries see either all oldvalues or all new values, not a mix of old and new values.</p><p>数据库始终保持一致的状态——每次提交或回滚之后以及事务正在进行时。如果跨多个表更新相关数据，则查询会看到所有旧值或所有新值，而不是新旧值的混合。</p><p>Transactions are protected (isolated) from each other while they arein progress; they cannot interfere with each other or see each other'suncommitted data. This isolation is achieved through the lockingmechanism. Experienced users can adjust the isolation level, trading offless protection in favor of increased performance and concurrency, whenthey can be sure that the transactions really do not interfere with eachother.</p><p>交易在进行过程中相互保护（隔离）；他们不能互相干扰或看到彼此未提交的数据。这种隔离是通过锁定机制实现的。当有经验的用户可以确定事务确实不会相互干扰时，他们可以调整隔离级别，以减少保护来提高性能和并发性。</p><p>The results of transactions are durable: once a commit operationsucceeds, the changes made by that transaction are safe from powerfailures, system crashes, race conditions, or other potential dangersthat many non-database applications are vulnerable to. Durabilitytypically involves writing to disk storage, with a certain amount ofredundancy to protect against power failures or software crashes duringwrite operations. (In InnoDB, the doublewrite buffer assists withdurability.)</p><p>事务的结果是持久的：一旦提交操作成功，该事务所做的更改就不会受到电源故障、系统崩溃、竞争条件或许多非数据库应用程序容易遭受的其他潜在危险的影响。持久性通常涉及写入磁盘存储，并具有一定量的冗余，以防止写入操作期间发生电源故障或软件崩溃。（在 InnoDB 中，双写缓冲区有助于提高耐用性。）</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;InnoDB is a general-purpose storage engine that balances high
reliability and high performance. In MySQL 8.0, InnoDB is the default
MySQL storage engine. Unless you have configured a different default
storage engine, issuing a CREATE TABLE statement without an ENGINE
clause creates an InnoDB table.&lt;/p&gt;
&lt;p&gt;InnoDB是一种平衡高可靠性和高性能的通用存储引擎。在MySQL
8.0中，InnoDB是MySQL默认的存储引擎。除非您配置了不同的默认存储引擎，否则发出不带
ENGINE 子句的 CREATE TABLE 语句将创建一个 InnoDB 表。&lt;/p&gt;
    
    </summary>
    
    
      <category term="数据库" scheme="http://yoursite.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="MySQL" scheme="http://yoursite.com/tags/MySQL/"/>
    
      <category term="InnoDB" scheme="http://yoursite.com/tags/InnoDB/"/>
    
  </entry>
  
  <entry>
    <title>MySQL数据库GROUP_CONCAT()函数输出结果的长度限制</title>
    <link href="http://yoursite.com/2023/08/16/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93GROUP_CONCAT()%E5%87%BD%E6%95%B0%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E7%9A%84%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6/"/>
    <id>http://yoursite.com/2023/08/16/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93GROUP_CONCAT()%E5%87%BD%E6%95%B0%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E7%9A%84%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6/</id>
    <published>2023-08-16T07:09:39.000Z</published>
    <updated>2023-08-16T07:22:46.045Z</updated>
    
    <content type="html"><![CDATA[<p>GROUP_CONCAT()函数输出的结果，发现被截取了一部分，并没有显示完整，原来GROUP_CONCAT()默认的输出长度为1024字节，超出的部分会被截掉不显示。</p><span id="more"></span><h2 id="group_concat">GROUP_CONCAT()</h2><p>MySQL官方文档关于<ahref="https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html#function_group-concat">GROUP_CONCAT()</a>函数的说明：</p><img src="/2023/08/16/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93GROUP_CONCAT()%E5%87%BD%E6%95%B0%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E7%9A%84%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230816145238.png" class=""><p>文档中除了 GROUP_CONCAT()函数的语法和使用，还提到：</p><blockquote><p>结果被截断为 <code>group_concat_max_len</code>系统变量指定的最大长度，该变量的默认值为 1024</p></blockquote><p>group_concat() 函数输出的结果长度，由<code>group_concat_max_len</code>系统变量所限制，超出设置的最大长度，将会被截掉，<code>group_concat_max_len</code> 的默认长度为<code>1024</code></p><p>在运行时更改 <code>group_concat_max_len</code> 值的语法如下，其中 val是无符号整数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET [GLOBAL | SESSION] group_concat_max_len = val;</span><br></pre></td></tr></table></figure><h2 id="groyp_concat_max_len">GROYP_CONCAT_MAX_LEN</h2><p>MySQL官方文档关于服务器系统变量 <ahref="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_group_concat_max_len">group_concat_max_len</a>的解释：</p><img src="/2023/08/16/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93GROUP_CONCAT()%E5%87%BD%E6%95%B0%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E7%9A%84%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230816144139.png" class=""><p>GROUP_CONCAT() 函数的长度以字节为单位，默认值为 1024。</p><p>64位系统值<code>18446744073709551615</code>,63为系统值<code>4294967295</code>,最小值都为<code>4</code>。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;GROUP_CONCAT()函数输出的结果，发现被截取了一部分，并没有显示完整，原来GROUP_CONCAT()
默认的输出长度为1024字节，超出的部分会被截掉不显示。&lt;/p&gt;
    
    </summary>
    
    
      <category term="数据库" scheme="http://yoursite.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="MySQL" scheme="http://yoursite.com/tags/MySQL/"/>
    
      <category term="group_concat" scheme="http://yoursite.com/tags/group-concat/"/>
    
      <category term="group_concat_max_len" scheme="http://yoursite.com/tags/group-concat-max-len/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot与SpringCloud</title>
    <link href="http://yoursite.com/2023/07/14/SpringBoot%E4%B8%8ESpringCloud/"/>
    <id>http://yoursite.com/2023/07/14/SpringBoot%E4%B8%8ESpringCloud/</id>
    <published>2023-07-14T05:33:33.000Z</published>
    <updated>2023-07-14T11:17:26.642Z</updated>
    
    <content type="html"><![CDATA[<h1 id="springboot">1. SpringBoot</h1><h2 id="springboot的作用">1.1 SpringBoot的作用</h2><p>SpringBoot是一个快速构建项目并简化项目配置的工具，内部集成了Tomcat及大多数第三方应用和Spring框架的默认配置。与我们学习的SpringMVC和SpringCloud并无冲突,SpringBoot提供的这些默认配置，大大简化了SpringMVC、SpringCloud等基于Spring的Web应用的开发。</p><h2id="springboot的自动配置原理如何实现">1.2.SpringBoot的自动配置原理（如何实现）？</h2><h3id="springboot的自动配置是如何实现的">SpringBoot的自动配置是如何实现的？</h3><p>一般我们的SpringBoot项目启动类都会添加<code>@SpringBootApplication</code>注解，而这个注解的其中一个二级注解是<code>@EnableAutoConfiguration</code>注解。而<code>@EnableAutoConfiguration</code>注解通过<code>@Import</code>注解，以<code>ImportSelector</code>接口的方法来导入classpath下的<code>META-INF/spring.factories</code>文件，这些文件中会指定需要加载的一些类名称。</p><p>这些类一般都加了<code>@Configuration</code>注解，并且完成了对某框架（例如Redis、SpringMVC）的默认配置，当这些类符合条件时，就会被实例化，其中的配置生效，那么自动配置自然生效了。</p><span id="more"></span><h3 id="满足怎样的条件配置才会生效">满足怎样的条件配置才会生效？</h3><p>一般提供默认配置的类都会添加<code>@ConditionalOnXxx</code>这样的注解，例如：<code>@ConditionalOnClass</code>，<code>@ConditionalOnProperties</code>等。<code>@ConditionalOnClass</code>表示只有classpath中存在某些指定的类时，条件满足，此时该配置类才会生效。例如Redis的默认配置其实早就有了，但是只有你引入redis的starter依赖，才满足了条件，触发自动配置。</p><h3id="那如果我需要覆盖这些默认配置呢">那如果我需要覆盖这些默认配置呢？</h3><p>有两种方式可以覆盖默认配置：</p><ul><li>SpringBoot提供默认配置时，会在提供的Bean上加注解@ConditionalOnMissingBean，意思是如果这个Bean不存在时条件满足，那么我们只要配置了相同的Bean，那么SpringBoot提供的默认配置就会失效</li><li>SpringBoot提供默认配置时，一些关键属性会通过读取application.yml或者application.properties文件来获取，因此我们可以通过覆盖任意一个文件中的属性来覆盖默认配置。</li></ul><h2 id="自定义springboot的stater">1.3 自定义SpringBoot的stater？</h2><p>项目中某些中间件的客户端（如Redis、ElasticSearch）会进行二次封装，并通过starter方式提供jar包，供大家使用。</p><p>一般定义starter包括下面几个子工程：</p><ul><li>xxx-spring-boot-starter：pom格式，管理当前starter中需要的各种依赖</li><li>xxx-spring-boot-autoconfigure：jar格式，自动配置的核心代码</li></ul><p>以elasticsearch为例来说说autoconfigure中包含哪些</p><ul><li>elasticsearch的工具类</li><li>属性加载的类，一般通过@ConfigurationProperties注解读取yaml文件中的es地址</li><li>添加了@Configuration的配置类，作用是初始化elasticsearch工具类，初始化elasticsearch客户端，初始化一些其它必备的实例。</li><li>resource下定义META-INF文件夹，并且文件夹下定义spring.factories文件，文件中是key-value形式:key是EnableAutoConfiguration这个注解的全路径名,value是我们自定义自动配置类（加了@Configuration的类），如果有多个以","隔开</li></ul><h2 id="springboot项目的启动流程">1.4 SpringBoot项目的启动流程</h2><p>SpringBoot项目启动第一步就是创建SpringApplication的实例，并且调用SpringApplication.run()这个方法。</p><p>创建SpringApplication实例主要完成三件事情：</p><ul><li>记录当前启动类字节码</li><li>判断当前项目类型，普通Servlet、响应式WebFlux、NONE</li><li>加载/META-INF/spring.factories文件，初始化ApplicationContextInitializer和ApplicationListener实例</li></ul><p>而后的run()方法则会创建spring容器，流程如下：</p><ul><li>准备监听器，监听Spring启动的各个过程</li><li>创建并配置环境参数Environment</li><li>创建ApplicationContext</li><li>prepareContext()：初始化ApplicationContext，准备运行环境</li><li>refreshContext(context)：准备Bean工厂，调用一个BeanDefinition和BeanFactory的后处理器，初始化各种Bean，初始化tomcat</li><li>afterRefresh()：拓展功能，目前为空</li><li>发布容器初始化完毕的事件</li></ul><h2 id="springboot的配置加载优先级">1.5 SpringBoot的配置加载优先级</h2><p>SpringBoot参数配置方式很多，比较常用参数配置方式按照优先级从高到低分别是：</p><ul><li>在命令行中传入的参数</li><li>java 的系统属性，可以通过System.getProperties()获得的内容</li><li>操作系统的环境变量</li><li>针对不同{profile}环境的配置文件内容，例如applicaiton-{profile}.yaml</li><li>application.yml或application.proerties文件</li><li>在@Configration注解修改的类中，通过@PropertySource注解定义的属性</li></ul><h1 id="springcloud">2 SpringCloud</h1><h2 id="springcloud和dubbo的区别">2.1 SpringCloud和Dubbo的区别</h2><p>两者都是现在主流的微服务框架，但却存在不少差异：</p><ul><li>初始定位不同：SpringCloud定位为微服务架构下的一站式解决方案；Dubbo是 SOA 时代的产物，它的关注点主要在于服务的调用和治理</li><li>生态环境不同：SpringCloud依托于Spring平台，具备更加完善的生态体系；而Dubbo一开始只是做RPC远程调用，生态相对匮乏，现在逐渐丰富起来。</li><li>调用方式：SpringCloud是采用Http协议做远程调用，接口一般是Rest风格，比较灵活；Dubbo是采用Dubbo协议，接口一般是Java的Service接口，格式固定。但调用时采用Netty的NIO方式，性能较好。</li><li>组件差异比较多，例如SpringCloud注册中心一般用Eureka，而Dubbo用的是Zookeeper</li></ul><p>SpringCloud生态丰富，功能完善，更像是品牌机，Dubbo则相对灵活，可定制性强，更像是组装机。</p><p>两者的生态对比：</p><table><thead><tr class="header"><th>功能</th><th>Dubbo</th><th>SpringCloud</th></tr></thead><tbody><tr class="odd"><td>服务注册中心</td><td>Zookeeper</td><td>Eureka(主流）、Consul、zookeeper</td></tr><tr class="even"><td>服务调用方式</td><td>RPC基于Dubbo协议</td><td>REST API 基于Http协议</td></tr><tr class="odd"><td>服务监控</td><td>Dubbo-Monitor</td><td>Spring Boot Admin</td></tr><tr class="even"><td>熔断器</td><td>不完善</td><td>Spring Cloud Netflix Hystrix</td></tr><tr class="odd"><td>服务网关</td><td>无</td><td>Spring Cloud Netflix Zuul、Gateway</td></tr><tr class="even"><td>分布式配置</td><td>无</td><td>Spring Cloud Config</td></tr><tr class="odd"><td>服务跟踪</td><td>无</td><td>Spring Cloud Sleuth+Zipkin(一般)</td></tr><tr class="even"><td>数据流</td><td>无</td><td>Spring Cloud Stream</td></tr><tr class="odd"><td>批量任务</td><td>无</td><td>Spring Cloud Task</td></tr><tr class="even"><td>信息总线</td><td>无</td><td>Spring Cloud Bus</td></tr></tbody></table><p>Spring Cloud 的功能很明显比 Dubbo 更加强大，涵盖面更广，而且作为Spring 的旗舰项目，它也能够与 Spring Framework、Spring Boot、SpringData、Spring Batch 等其他 Spring项目完美融合，这些对于微服务而言是至关重要的。</p><p>使用 Dubbo构建的微服务架构就像组装电脑，各环节选择自由度很高，但是最终结果很有可能因为一条内存质量不行就点不亮了，总是让人不怎么放心，但是如果使用者是一名高手，那这些都不是问题。</p><h2 id="dubbo和feign远程调用的差异">2.2 dubbo和Feign远程调用的差异</h2><p>Feign是SpringCloud中的远程调用方式，基于成熟Http协议，所有接口都采用Rest风格。因此接口规范更统一，而且只要符合规范，实现接口的微服务可以采用任意语言或技术开发。但受限于http协议本身的特点，请求和响应格式臃肿，其通信效率相对会差一些。</p><p>Dubbo框架默认采用Dubbo自定义通信协议，与Http协议一样底层都是TCP通信。但是Dubbo协议自定义了Java数据序列化和反序列化方式、数据传输格式，因此Dubbo在数据传输性能上会比Http协议要好一些。</p><p>不过这种性能差异除非是达极高的并发量级，否则无需过多考虑。</p><h2 id="eureka和zookeeper注册中心的区别">2.3Eureka和Zookeeper注册中心的区别</h2><p>SpringCloud和Dubbo都支持多种注册中心，不过目前主流来看SpringCloud用Eureka较多，Dubbo则以Zookeeper为主。两者存在较大的差异：</p><ul><li>从集群设计来看：Eureka集群各节点平等，没有主从关系，因此可能出现数据不一致情况；ZK为了满足一致性，必须包含主从关系，一主多从。集群无主时，不对外提供服务</li><li>CAP原则来看：Eureka满足AP原则，为了保证整个服务可用性，牺牲了集群数据的一致性；而Zookeeper满足CP原则，为了保证各节点数据一致性，牺牲了整个服务的可用性。</li><li>服务拉取方式来看：Eureka采用的是服务主动拉取策略，消费者按照固定频率（默认30秒）去Eureka拉取服务并缓存在本地；ZK中的消费者首次启动到ZK订阅自己需要的服务信息，并缓存在本地。然后监听服务列表变化，以后服务变更ZK会推送给消费者。</li></ul><p><strong>扩展：</strong></p><p>首先，Eureka和Zookeeper都是服务治理框架，但是设计上有一定的差别。</p><p>先看下CAP原则：C-数据一致性；A-服务可用性；P-服务对网络分区故障的容错性，这三个特性在任何分布式系统中不能同时满足，最多同时满足两个。</p><p>Eureka满足AP，Zookeeper满足CP</p><p>当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息，但不能接受服务直接down掉不可用。也就是说，服务注册功能对可用性的要求要高于一致性。但是Zookeeper和Eureka在一致性与可用性间做出了不同的选择。</p><p>Zookeeper：Zookeeper的设计追求数据的一致性，不保证服务的可用性。当master节点因为网络故障与其他节点失去联系时，剩余节点会重新进行leader选举。问题在于，选举leader的时间太长，30~ 120s,且选举期间整个zk集群都是不可用的，这就导致在选举期间注册服务瘫痪。在云部署的环境下，因网络问题使得zk集群失去master节点是较大概率会发生的事，虽然服务能够最终恢复，但是漫长的选举时间导致的注册长期不可用是不能容忍的。</p><p>Eureka：Eureka追求的是服务的可用性，从而牺牲了数据的一致性。Eureka各个节点都是平等的，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。而Eureka的客户端在向某个Eureka注册或时如果发现连接失败，则会自动切换至其它节点，只要有一台Eureka还在，就能保证注册服务可用(保证可用性)，只不过查到的信息可能不是最新的(不保证强一致性)。除此之外，Eureka还有一种自我保护机制，如果在15分钟内超过85%的节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现了网络故障，此时会出现以下几种情况。</p><ol type="1"><li>Eureka不再从注册列表中移除因为长时间没收到心跳而应该过期的服务</li><li>Eureka仍然能够接受新服务的注册和查询请求，但是不会被同步到其它节点上(即保证当前节点依然可用)</li><li>当网络稳定时，当前实例新的注册信息会被同步到其它节点中</li></ol><p>因此，Eureka可以很好的应对因网络故障导致部分节点失去联系的情况，而不会像zookeeper那样使整个注册服务瘫痪。</p><p>Eureka集群各节点平等，Zookeeper中有主从之分</p><ol type="1"><li>如果Zookeeper集群中部分宕机，可能会导致整个集群因为选主而阻塞，服务不可用</li><li>Eureka集群宕机部分，不会对其它机器产生影响</li></ol><p>Eureka的服务发现需要主动去拉取，Zookeeper服务发现是监听机制</p><ol type="1"><li>Eureka中获取服务列表后会缓存起来，每隔30秒重新拉取服务列表</li><li>Zookeeper则是监听节点信息变化，当服务节点信息变化时，客户端立即就得到通知</li></ol><h2 id="springcloud中的常用组件有哪些">2.4SpringCloud中的常用组件有哪些？</h2><p>Spring Cloud的子项目很多，比较常见的都是Netflix开源的组件：</p><ul><li>Spring Cloud Config</li></ul><p>集中配置管理工具，分布式系统中统一的外部配置管理，默认使用Git来存储配置，可以支持客户端配置的刷新及加密、解密操作。</p><ul><li>Spring Cloud Netflix</li></ul><p>Netflix OSS开源组件集成，包括Eureka、Hystrix、Ribbon、Feign、Zuul等核心组件。</p><p>Eureka：服务治理组件，包括服务端的注册中心和客户端的服务发现机制；Ribbon：负载均衡的服务调用组件，具有多种负载均衡调用策略；Hystrix：服务容错组件，实现了断路器模式，为依赖服务的出错和延迟提供了容错能力；Feign：基于Ribbon和Hystrix的声明式服务调用组件；Zuul：API网关组件，对请求提供路由及过滤功能。 Spring Cloud Bus用于传播集群状态变化的消息总线，使用轻量级消息代理链接分布式系统中的节点，可以用来动态刷新集群中的服务配置。</p><ul><li>Spring Cloud Consul</li></ul><p>基于Hashicorp Consul的服务治理组件。</p><ul><li>Spring Cloud Security</li></ul><p>安全工具包，对Zuul代理中的负载均衡OAuth2客户端及登录认证进行支持。</p><ul><li>Spring Cloud Sleuth</li></ul><p>SpringCloud应用程序的分布式请求链路跟踪，支持使用Zipkin、HTrace和基于日志（例如ELK）的跟踪。</p><ul><li>Spring Cloud Stream</li></ul><p>轻量级事件驱动微服务框架，可以使用简单的声明式模型来发送及接收消息，主要实现为ApacheKafka及RabbitMQ。</p><ul><li>Spring Cloud Task</li></ul><p>用于快速构建短暂、有限数据处理任务的微服务框架，用于向应用中添加功能性和非功能性的特性。</p><ul><li>Spring Cloud Zookeeper</li></ul><p>基于Apache Zookeeper的服务治理组件。</p><ul><li>Spring Cloud Gateway</li></ul><p>API网关组件，对请求提供路由及过滤功能。</p><ul><li>Spring Cloud OpenFeign</li></ul><p>基于Ribbon和Hystrix的声明式服务调用组件，可以动态创建基于SpringMVC注解的接口实现用于服务调用，在Spring Cloud2.0中已经取代Feign成为了一等公民。</p><hr /><p>未完待续</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;springboot&quot;&gt;1. SpringBoot&lt;/h1&gt;
&lt;h2 id=&quot;springboot的作用&quot;&gt;1.1 SpringBoot的作用&lt;/h2&gt;
&lt;p&gt;SpringBoot是一个快速构建项目并简化项目配置的工具，内部集成了Tomcat及大多数第三方应用和Spring框架的默认配置。与我们学习的SpringMVC和SpringCloud并无冲突,SpringBoot提供的这些默认配置，大大简化了SpringMVC、SpringCloud等基于Spring的Web应用的开发。&lt;/p&gt;
&lt;h2
id=&quot;springboot的自动配置原理如何实现&quot;&gt;1.2.SpringBoot的自动配置原理（如何实现）？&lt;/h2&gt;
&lt;h3
id=&quot;springboot的自动配置是如何实现的&quot;&gt;SpringBoot的自动配置是如何实现的？&lt;/h3&gt;
&lt;p&gt;一般我们的SpringBoot项目启动类都会添加&lt;code&gt;@SpringBootApplication&lt;/code&gt;注解，而这个注解的其中一个二级注解是&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;注解。而&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;注解通过&lt;code&gt;@Import&lt;/code&gt;注解，以&lt;code&gt;ImportSelector&lt;/code&gt;接口的方法来导入classpath下的&lt;code&gt;META-INF/spring.factories&lt;/code&gt;文件，这些文件中会指定需要加载的一些类名称。&lt;/p&gt;
&lt;p&gt;这些类一般都加了&lt;code&gt;@Configuration&lt;/code&gt;注解，并且完成了对某框架（例如Redis、SpringMVC）的默认配置，当这些类符合条件时，就会被实例化，其中的配置生效，那么自动配置自然生效了。&lt;/p&gt;
    
    </summary>
    
    
      <category term="代码人生" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="SpringCloud" scheme="http://yoursite.com/tags/SpringCloud/"/>
    
      <category term="SpringBoot" scheme="http://yoursite.com/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis配置allowMultiQueries=true允许使用foreach标签批量插入或更新数据</title>
    <link href="http://yoursite.com/2023/06/30/MyBatis%E9%85%8D%E7%BD%AEallowMultiQueries-true%E5%85%81%E8%AE%B8%E4%BD%BF%E7%94%A8foreach%E6%A0%87%E7%AD%BE%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%88%96%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE/"/>
    <id>http://yoursite.com/2023/06/30/MyBatis%E9%85%8D%E7%BD%AEallowMultiQueries-true%E5%85%81%E8%AE%B8%E4%BD%BF%E7%94%A8foreach%E6%A0%87%E7%AD%BE%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%88%96%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE/</id>
    <published>2023-06-30T04:59:35.000Z</published>
    <updated>2023-06-30T05:01:00.437Z</updated>
    
    <content type="html"><![CDATA[<p>执行update更新操作</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;batchUpdate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.util.List&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;;&quot;</span> <span class="attr">open</span>=<span class="string">&quot;&quot;</span> <span class="attr">close</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        update test_table</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;item.a != null&quot;</span>&gt;</span>output_amount = #&#123;item.a&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;item.b!= null&quot;</span>&gt;</span>invoice_amount = #&#123;item.b&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;item.c!= null&quot;</span>&gt;</span>payment_amount = #&#123;item.c&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;item.id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><p>执行报错： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Error updating database.  </span><br><span class="line">Cause: java.sql.SQLSyntaxErrorException: </span><br><span class="line">You have an error in your SQL syntax; </span><br><span class="line">check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;update test_table set a = 1, &#x27; at line 14</span><br></pre></td></tr></table></figure></p><p>刚开始出现这个错误，以为是update语句写的有问题，但是检查了很多遍都没有问题。奇怪的是，同样的代码，同样的数据，本地启的环境不行，测试环境却可以。经过同事提醒了一下，于是检查了一下配置文件，果然发现配置文件上的jdbc配置，测试环境比开发环境多了个<code>allowMultiQueries=true</code>。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:mysql://127.0.0.1:3306/db?useUnicode=true&amp;characterEncoding=utf8&amp;allowMultiQueries=true&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8&amp;nullCatalogMeansCurrent=true</span><br></pre></td></tr></table></figure><p>MyBatis默认情况下不允许批量插入或更新数据的原因是出于安全考虑。在许多情况下，数据的插入和更新都需要经过验证和控制，以确保数据的完整性和一致性。如果允许默认的批量操作，可能会导致不正确的数据插入或更新，从而影响应用程序的正常运行。</p><p>通过配置<code>allowMultiQueries=true</code>可以开启MyBatis的批量操作功能。这个配置项告诉MyBatis允许在单个数据库连接中执行多个SQL语句，从而实现批量插入或更新数据的功能。但是要注意，在开启批量操作之前，确保你已经了解并理解了可能引发的安全风险，并且在使用批量操作时要进行适当的验证和控制，以确保数据的完整性和安全性。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;执行update更新操作&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/s
      
    
    </summary>
    
    
      <category term="MySQL" scheme="http://yoursite.com/categories/MySQL/"/>
    
      <category term="代码人生" scheme="http://yoursite.com/categories/MySQL/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
      <category term="数据库" scheme="http://yoursite.com/categories/MySQL/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="MySQL" scheme="http://yoursite.com/tags/MySQL/"/>
    
      <category term="allowMultiQueries" scheme="http://yoursite.com/tags/allowMultiQueries/"/>
    
  </entry>
  
  <entry>
    <title>Flowable工作流重启已经结束的流程</title>
    <link href="http://yoursite.com/2023/06/30/Flowable%E5%B7%A5%E4%BD%9C%E6%B5%81%E9%87%8D%E5%90%AF%E5%B7%B2%E7%BB%8F%E7%BB%93%E6%9D%9F%E7%9A%84%E6%B5%81%E7%A8%8B/"/>
    <id>http://yoursite.com/2023/06/30/Flowable%E5%B7%A5%E4%BD%9C%E6%B5%81%E9%87%8D%E5%90%AF%E5%B7%B2%E7%BB%8F%E7%BB%93%E6%9D%9F%E7%9A%84%E6%B5%81%E7%A8%8B/</id>
    <published>2023-06-30T03:51:32.000Z</published>
    <updated>2023-06-30T03:57:41.499Z</updated>
    
    <content type="html"><![CDATA[<h2id="使用historyservice接口来查询历史流程实例">使用<code>HistoryService</code>接口来查询历史流程实例</h2><p>在Flowable中，已终止的流程实例不能通过<code>RuntimeService</code>接口直接查询到。相反，你需要使用<code>HistoryService</code>接口来查询历史流程实例，并从中筛选出已终止的实例。以下是正确的步骤：</p><ol type="1"><li><p>确保你的应用程序连接到正确的Flowable流程引擎实例。你需要使用Flowable的API来执行后续的操作。</p></li><li><p>使用<code>HistoryService</code>接口的<code>createHistoricProcessInstanceQuery()</code>方法构建查询，设置适当的条件来筛选已终止的流程实例。</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HistoricProcessInstanceQuery</span> <span class="variable">query</span> <span class="operator">=</span> historyService.createHistoricProcessInstanceQuery()</span><br><span class="line">.finished();</span><br></pre></td></tr></table></figure><ol start="3" type="1"><li>执行查询并获取已终止的流程实例列表。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;HistoricProcessInstance&gt; terminatedInstances = query.list();</span><br></pre></td></tr></table></figure><ol start="4" type="1"><li><p>根据需要选择要重启的流程实例。你可以根据流程实例的ID或其他属性进行选择。</p></li><li><p>如果你需要将已终止的流程实例重新激活，可以创建一个新的流程实例，或者使用历史流程实例中的数据进行修复。请注意，这取决于你的业务需求和流程定义的复杂性。</p></li></ol><p>请注意，已终止的流程实例是历史数据，因此无法直接重新激活。你需要根据业务需求进行相应的处理。使用<code>HistoryService</code>接口可以提供有关已终止流程实例的详细信息，但不能直接操作它们。</p><span id="more"></span><h2id="使用historyservice获取的流程实例信息重新发起一个新的流程实例">使用<code>HistoryService</code>获取的流程实例信息重新发起一个新的流程实例</h2><p>要使用<code>HistoryService</code>获取的流程实例信息重新发起一个新的流程实例，你需要执行以下步骤：</p><ol type="1"><li>获取已终止流程实例的相关信息，如流程定义ID、业务关联键等。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">processDefinitionId</span> <span class="operator">=</span> historicProcessInstance.getProcessDefinitionId();</span><br><span class="line"><span class="type">String</span> <span class="variable">businessKey</span> <span class="operator">=</span> historicProcessInstance.getBusinessKey();</span><br><span class="line"><span class="comment">// 其他需要的信息</span></span><br></pre></td></tr></table></figure><ol start="2" type="1"><li>使用<code>RuntimeService</code>接口的<code>startProcessInstanceById()</code>方法或<code>startProcessInstanceByKey()</code>方法来启动新的流程实例。根据你的需求选择合适的方法。</li></ol><p>如果你选择使用流程定义ID：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ProcessInstance</span> <span class="variable">newProcessInstance</span> <span class="operator">=</span> runtimeService</span><br><span class="line">.startProcessInstanceById(processDefinitionId, businessKey);</span><br></pre></td></tr></table></figure><p>如果你选择使用流程定义的键（Key）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ProcessInstance</span> <span class="variable">newProcessInstance</span> <span class="operator">=</span> runtimeService</span><br><span class="line">.startProcessInstanceByKey(processDefinitionKey, businessKey);</span><br></pre></td></tr></table></figure><p>在这里，<code>processDefinitionKey</code>是流程定义的键（Key）。</p><ol start="3" type="1"><li>在启动新的流程实例后，你可以执行后续的操作，例如处理任务等，以继续流程的执行。</li></ol><p>请注意，重新发起的新流程实例与原始已终止的流程实例是独立的。你需要根据需求来处理任何必要的数据复制或流程初始化操作。</p><h2id="设置重新发起的流程实例的变量variables">设置重新发起的流程实例的变量（variables）</h2><p>要设置重新发起的流程实例的变量（variables），你可以使用<code>RuntimeService</code>接口的<code>startProcessInstanceById()</code>或<code>startProcessInstanceByKey()</code>方法的重载版本来指定变量的值。以下是设置变量的步骤：</p><ol type="1"><li>获取已终止流程实例的相关信息，如流程定义ID、业务关联键等。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">processDefinitionId</span> <span class="operator">=</span> historicProcessInstance.getProcessDefinitionId();</span><br><span class="line"><span class="type">String</span> <span class="variable">businessKey</span> <span class="operator">=</span> historicProcessInstance.getBusinessKey();</span><br><span class="line"><span class="comment">// 其他需要的信息</span></span><br></pre></td></tr></table></figure><ol start="2" type="1"><li>创建一个<code>Map</code>对象，将变量名和对应的值放入该对象中。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">variables.put(<span class="string">&quot;variable1&quot;</span>, value1);</span><br><span class="line">variables.put(<span class="string">&quot;variable2&quot;</span>, value2);</span><br><span class="line"><span class="comment">// 添加其他变量</span></span><br></pre></td></tr></table></figure><p>在上述代码中，"variable1"和"variable2"是变量名，value1和value2是对应的值。</p><ol start="3" type="1"><li>使用<code>RuntimeService</code>接口的<code>startProcessInstanceById()</code>方法或<code>startProcessInstanceByKey()</code>方法的重载版本来启动新的流程实例，并在参数中传递变量的Map对象。</li></ol><p>如果你选择使用流程定义ID：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ProcessInstance</span> <span class="variable">newProcessInstance</span> <span class="operator">=</span> runtimeService</span><br><span class="line">.startProcessInstanceById(processDefinitionId, businessKey, variables);</span><br></pre></td></tr></table></figure><p>如果你选择使用流程定义的键（Key）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ProcessInstance</span> <span class="variable">newProcessInstance</span> <span class="operator">=</span> runtimeService</span><br><span class="line">.startProcessInstanceByKey(processDefinitionKey, businessKey, variables);</span><br></pre></td></tr></table></figure><ol start="4" type="1"><li>通过上述步骤，变量将与新的流程实例关联，并可以在流程的执行中使用。</li></ol><p>请注意，如果重新发起的流程实例需要使用历史流程实例的数据作为变量的值，你需要根据业务需求将这些数据复制到新的流程实例中。</p><h2id="关于新发起流程的processinstancename为空的情况说明">关于新发起流程的<code>processInstanceName</code>为空的情况说明</h2><p>在Flowable中，流程实例的名称（process instancename）是一个可选的属性，并且不会自动从历史流程实例中继承。因此，在重新发起流程实例时，<code>processInstanceName</code>默认为空。</p><p>如果你想为重新发起的流程实例设置一个名称，可以通过设置流程变量的方式来实现。以下是设置流程实例名称的步骤：</p><ol type="1"><li>获取已终止流程实例的相关信息，如流程定义ID、业务关联键等。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">processDefinitionId</span> <span class="operator">=</span> historicProcessInstance.getProcessDefinitionId();</span><br><span class="line"><span class="type">String</span> <span class="variable">businessKey</span> <span class="operator">=</span> historicProcessInstance.getBusinessKey();</span><br><span class="line"><span class="comment">// 其他需要的信息</span></span><br></pre></td></tr></table></figure><ol start="2" type="1"><li>使用<code>RuntimeService</code>接口的<code>startProcessInstanceById()</code>或<code>startProcessInstanceByKey()</code>方法启动新的流程实例，并在参数中传递变量的Map对象。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">variables.put(<span class="string">&quot;processInstanceName&quot;</span>, <span class="string">&quot;My Process Instance&quot;</span>); <span class="comment">// 设置流程实例名称</span></span><br><span class="line"></span><br><span class="line"><span class="type">ProcessInstance</span> <span class="variable">newProcessInstance</span> <span class="operator">=</span> runtimeService</span><br><span class="line">.startProcessInstanceById(processDefinitionId, businessKey, variables);</span><br></pre></td></tr></table></figure><p>在上述代码中，我们将流程实例名称作为变量<code>"processInstanceName"</code>的值传递给了<code>startProcessInstanceById()</code>方法。</p><ol start="3" type="1"><li>在新的流程实例中，你可以使用<code>RuntimeService</code>接口的<code>getVariable()</code>方法来获取流程实例名称。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">processInstanceName</span> <span class="operator">=</span> runtimeService</span><br><span class="line">.getVariable(newProcessInstance.getId(), <span class="string">&quot;processInstanceName&quot;</span>);</span><br></pre></td></tr></table></figure><p>在上述代码中，<code>newProcessInstance.getId()</code>是重新发起的流程实例的ID。</p><p>通过上述步骤，你可以在重新发起的流程实例中设置和获取流程实例名称。</p><h2id="关于流程中historicprocessinstance的endtime字段为空的情况说明">关于流程中<code>HistoricProcessInstance</code>的<code>endTime</code>字段为空的情况说明</h2><p>在Flowable中，<code>HistoricProcessInstance</code>的<code>endTime</code>字段为空是因为该字段仅在流程实例完成时被设置为非空值。当你重新发起一个新的流程实例时，该实例尚未完成，因此<code>endTime</code>字段仍然为空。</p><p><code>HistoricProcessInstance</code>对象表示已完成或已终止的流程实例的历史记录，其中<code>endTime</code>字段指示流程实例的结束时间。只有在流程实例完成时，即流程的所有活动都已完成，<code>endTime</code>字段才会被设置为相应的时间戳。</p><p>当你重新发起一个新的流程实例时，新的流程实例将被视为全新的实例，其<code>endTime</code>字段将在实例完成时被设置为相应的时间戳。因此，刚刚重新发起的流程实例的<code>endTime</code>字段为空是符合预期的行为。</p><p>如果你需要确定新流程实例的完成状态，你可以使用<code>RuntimeService</code>接口或其他相关接口来查询并检查流程实例的状态。例如，可以使用<code>RuntimeService</code>的<code>createProcessInstanceQuery()</code>方法查询并判断流程实例是否已完成。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ProcessInstanceQuery</span> <span class="variable">query</span> <span class="operator">=</span> runtimeService</span><br><span class="line">.createProcessInstanceQuery().processInstanceId(newProcessInstanceId);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">isProcessInstanceFinished</span> <span class="operator">=</span> query.singleResult() == <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>在上述代码中，<code>newProcessInstanceId</code>是你重新发起的新流程实例的ID。</p>]]></content>
    
    <summary type="html">
    
      &lt;h2
id=&quot;使用historyservice接口来查询历史流程实例&quot;&gt;使用&lt;code&gt;HistoryService&lt;/code&gt;接口来查询历史流程实例&lt;/h2&gt;
&lt;p&gt;在Flowable中，已终止的流程实例不能通过&lt;code&gt;RuntimeService&lt;/code&gt;接口直接查询到。相反，你需要使用&lt;code&gt;HistoryService&lt;/code&gt;接口来查询历史流程实例，并从中筛选出已终止的实例。以下是正确的步骤：&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;&lt;p&gt;确保你的应用程序连接到正确的Flowable流程引擎实例。你需要使用Flowable的API来执行后续的操作。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;使用&lt;code&gt;HistoryService&lt;/code&gt;接口的&lt;code&gt;createHistoricProcessInstanceQuery()&lt;/code&gt;方法构建查询，设置适当的条件来筛选已终止的流程实例。&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;HistoricProcessInstanceQuery&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; historyService.createHistoricProcessInstanceQuery()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		.finished();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol start=&quot;3&quot; type=&quot;1&quot;&gt;
&lt;li&gt;执行查询并获取已终止的流程实例列表。&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;List&amp;lt;HistoricProcessInstance&amp;gt; terminatedInstances = query.list();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol start=&quot;4&quot; type=&quot;1&quot;&gt;
&lt;li&gt;&lt;p&gt;根据需要选择要重启的流程实例。你可以根据流程实例的ID或其他属性进行选择。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;如果你需要将已终止的流程实例重新激活，可以创建一个新的流程实例，或者使用历史流程实例中的数据进行修复。请注意，这取决于你的业务需求和流程定义的复杂性。&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;请注意，已终止的流程实例是历史数据，因此无法直接重新激活。你需要根据业务需求进行相应的处理。使用&lt;code&gt;HistoryService&lt;/code&gt;接口可以提供有关已终止流程实例的详细信息，但不能直接操作它们。&lt;/p&gt;
    
    </summary>
    
    
      <category term="代码人生" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
      <category term="Flowable" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/Flowable/"/>
    
    
      <category term="flowable" scheme="http://yoursite.com/tags/flowable/"/>
    
  </entry>
  
  <entry>
    <title>List＜String＞集合转Long[]数组</title>
    <link href="http://yoursite.com/2023/06/13/List%EF%BC%9CString%EF%BC%9E%E9%9B%86%E5%90%88%E8%BD%ACLong-%E6%95%B0%E7%BB%84/"/>
    <id>http://yoursite.com/2023/06/13/List%EF%BC%9CString%EF%BC%9E%E9%9B%86%E5%90%88%E8%BD%ACLong-%E6%95%B0%E7%BB%84/</id>
    <published>2023-06-13T07:54:46.000Z</published>
    <updated>2023-06-13T07:58:35.155Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Long[] item = list.toArray(<span class="keyword">new</span> <span class="title class_">Long</span>[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure><p><code>List&lt;String&gt;</code>直接以toArray的方式转换<code>Long数组</code>是错误的，运行后报错：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.ArrayStoreException</span><br></pre></td></tr></table></figure><p>查看<code>java.util.List.toArray(T[])</code>方法，注释中明确写到：</p><blockquote><p><span class="citation" data-cites="throws">@throws</span>ArrayStoreException if the runtime type of the specified array is not asupertype of the runtime type of every element in this list如果指定数组的运行时类型不是此列表中每个元素的运行时类型的超类型</p></blockquote><p>明显Long类型不是String类型的超类。</p><p>可以通过下面的方式实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; stringList = Arrays.asList(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">Long[] item = list.stream().map(Long::valueOf).toArray(Long[]::<span class="keyword">new</span>);</span><br></pre></td></tr></table></figure><span id="more"></span><p><strong>引申：</strong></p><p>如何实现 <code>List&lt;String&gt;</code> 转<code>List&lt;Long&gt;</code> ?</p><p>实现方式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; stringList = Arrays.asList(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">List&lt;Long&gt; longList = stringList.stream().map(Long::valueOf).collect(Collectors.toList());</span><br></pre></td></tr></table></figure><hr /><p><code>java.util.List.toArray(T[])</code> 源码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an array containing all of the elements in this list in</span></span><br><span class="line"><span class="comment">     * proper sequence (from first to last element); the runtime type of</span></span><br><span class="line"><span class="comment">     * the returned array is that of the specified array.  If the list fits</span></span><br><span class="line"><span class="comment">     * in the specified array, it is returned therein.  Otherwise, a new</span></span><br><span class="line"><span class="comment">     * array is allocated with the runtime type of the specified array and</span></span><br><span class="line"><span class="comment">     * the size of this list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;If the list fits in the specified array with room to spare (i.e.,</span></span><br><span class="line"><span class="comment">     * the array has more elements than the list), the element in the array</span></span><br><span class="line"><span class="comment">     * immediately following the end of the list is set to &lt;tt&gt;null&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     * (This is useful in determining the length of the list &lt;i&gt;only&lt;/i&gt; if</span></span><br><span class="line"><span class="comment">     * the caller knows that the list does not contain any null elements.)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Like the &#123;<span class="doctag">@link</span> #toArray()&#125; method, this method acts as bridge between</span></span><br><span class="line"><span class="comment">     * array-based and collection-based APIs.  Further, this method allows</span></span><br><span class="line"><span class="comment">     * precise control over the runtime type of the output array, and may,</span></span><br><span class="line"><span class="comment">     * under certain circumstances, be used to save allocation costs.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Suppose &lt;tt&gt;x&lt;/tt&gt; is a list known to contain only strings.</span></span><br><span class="line"><span class="comment">     * The following code can be used to dump the list into a newly</span></span><br><span class="line"><span class="comment">     * allocated array of &lt;tt&gt;String&lt;/tt&gt;:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;pre&gt;&#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment">     *     String[] y = x.toArray(new String[0]);</span></span><br><span class="line"><span class="comment">     * &#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Note that &lt;tt&gt;toArray(new Object[0])&lt;/tt&gt; is identical in function to</span></span><br><span class="line"><span class="comment">     * &lt;tt&gt;toArray()&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> a the array into which the elements of this list are to</span></span><br><span class="line"><span class="comment">     *          be stored, if it is big enough; otherwise, a new array of the</span></span><br><span class="line"><span class="comment">     *          same runtime type is allocated for this purpose.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> an array containing the elements of this list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ArrayStoreException if the runtime type of the specified array</span></span><br><span class="line"><span class="comment">     *         is not a supertype of the runtime type of every element in</span></span><br><span class="line"><span class="comment">     *         this list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the specified array is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    &lt;T&gt; T[] toArray(T[] a);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;List&amp;lt;String&amp;gt; list = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;ArrayList&lt;/span&gt;&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Long[] item = list.toArray(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Long&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt;直接以toArray的方式转换&lt;code&gt;Long数组&lt;/code&gt;是错误的，运行后报错：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Exception in thread &amp;quot;main&amp;quot; java.lang.ArrayStoreException&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;查看&lt;code&gt;java.util.List.toArray(T[])&lt;/code&gt;方法，注释中明确写到：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&quot;citation&quot; data-cites=&quot;throws&quot;&gt;@throws&lt;/span&gt;
ArrayStoreException if the runtime type of the specified array is not a
supertype of the runtime type of every element in this list
如果指定数组的运行时类型不是此列表中每个元素的运行时类型的超类型&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;明显Long类型不是String类型的超类。&lt;/p&gt;
&lt;p&gt;可以通过下面的方式实现&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;List&amp;lt;String&amp;gt; stringList = Arrays.asList(&lt;span class=&quot;string&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;3&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Long[] item = list.stream().map(Long::valueOf).toArray(Long[]::&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="代码人生" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="List" scheme="http://yoursite.com/tags/List/"/>
    
      <category term="String" scheme="http://yoursite.com/tags/String/"/>
    
      <category term="Long" scheme="http://yoursite.com/tags/Long/"/>
    
  </entry>
  
  <entry>
    <title>读取jar包中指定资源文件的内容</title>
    <link href="http://yoursite.com/2023/06/12/%E8%AF%BB%E5%8F%96jar%E5%8C%85%E4%B8%AD%E6%8C%87%E5%AE%9A%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9/"/>
    <id>http://yoursite.com/2023/06/12/%E8%AF%BB%E5%8F%96jar%E5%8C%85%E4%B8%AD%E6%8C%87%E5%AE%9A%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9/</id>
    <published>2023-06-12T11:05:13.000Z</published>
    <updated>2023-06-12T11:10:31.549Z</updated>
    
    <content type="html"><![CDATA[<p>背景描述：SpringBoot项目构建打包生成的jar包，在资源文件夹下有个普通txt文件，路径：<code>/templates/content.txt</code></p><h2 id="方式一">方式一：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(ResourceUtils.getURL(<span class="string">&quot;classpath:&quot;</span>).getPath());</span><br><span class="line"><span class="type">File</span> <span class="variable">templateFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(file, <span class="string">&quot;/templates/content.txt&quot;</span>);</span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">sbf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    reader = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(file));</span><br><span class="line">    String tempStr;</span><br><span class="line">    <span class="keyword">while</span> ((tempStr = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">        sbf.append(tempStr);</span><br><span class="line">    &#125;</span><br><span class="line">    reader.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (reader != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            reader.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e1) &#123;</span><br><span class="line">            e1.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> sbf.toString();</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="方式二">方式二：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;templates/content.txt&quot;</span>);</span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">sbf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">reader = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream));</span><br><span class="line">String tempStr;</span><br><span class="line"><span class="keyword">while</span> ((tempStr = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">    sbf.append(tempStr);</span><br><span class="line">&#125;</span><br><span class="line">reader.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (reader != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            reader.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e1) &#123;</span><br><span class="line">            e1.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> sbf.toString();</span><br></pre></td></tr></table></figure><p>文件位置示例：</p><img src="/2023/06/12/%E8%AF%BB%E5%8F%96jar%E5%8C%85%E4%B8%AD%E6%8C%87%E5%AE%9A%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9/resourcesfile.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;背景描述：SpringBoot项目构建打包生成的jar包，在资源文件夹下有个普通txt文件，路径：&lt;code&gt;/templates/content.txt&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;方式一&quot;&gt;方式一：&lt;/h2&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;File&lt;/span&gt;(ResourceUtils.getURL(&lt;span class=&quot;string&quot;&gt;&amp;quot;classpath:&amp;quot;&lt;/span&gt;).getPath());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;templateFile&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;File&lt;/span&gt;(file, &lt;span class=&quot;string&quot;&gt;&amp;quot;/templates/content.txt&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;BufferedReader&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;reader&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;StringBuffer&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;sbf&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;StringBuffer&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    reader = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;BufferedReader&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;FileReader&lt;/span&gt;(file));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String tempStr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; ((tempStr = reader.readLine()) != &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sbf.append(tempStr);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    reader.close();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (IOException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (reader != &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            reader.close();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (IOException e1) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            e1.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sbf.toString();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="代码人生" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="jar" scheme="http://yoursite.com/tags/jar/"/>
    
      <category term="File" scheme="http://yoursite.com/tags/File/"/>
    
  </entry>
  
  <entry>
    <title>Convert Image File to Base64 String or Base64 String to Image File in Java</title>
    <link href="http://yoursite.com/2023/06/07/Convert-Image-File-to-Base64-String-or-Base64-String-to-Image-File-in-Java/"/>
    <id>http://yoursite.com/2023/06/07/Convert-Image-File-to-Base64-String-or-Base64-String-to-Image-File-in-Java/</id>
    <published>2023-06-07T10:11:27.000Z</published>
    <updated>2023-06-07T10:29:25.002Z</updated>
    
    <content type="html"><![CDATA[<h2 id="add-maven-dependency">Add Maven Dependency</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="image-file-convert-base64-string">Image File Convert Base64String</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] fileContent = FileUtils.readFileToByteArray(<span class="keyword">new</span> <span class="title class_">File</span>(filePath));</span><br><span class="line"><span class="type">String</span> <span class="variable">encodedString</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(fileContent);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="base64-string-convert-image-file">Base64 String Convert ImageFile</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] decodedBytes = Base64.getDecoder().decode(encodedString);</span><br><span class="line">FileUtils.writeByteArrayToFile(<span class="keyword">new</span> <span class="title class_">File</span>(outputFileName), decodedBytes);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;add-maven-dependency&quot;&gt;Add Maven Dependency&lt;/h2&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;
      
    
    </summary>
    
    
      <category term="代码人生" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
    
  </entry>
  
  <entry>
    <title>SpringBoot项目下实践设计模式之工厂模式</title>
    <link href="http://yoursite.com/2023/04/23/SpringBoot%E9%A1%B9%E7%9B%AE%E4%B8%8B%E5%AE%9E%E8%B7%B5%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2023/04/23/SpringBoot%E9%A1%B9%E7%9B%AE%E4%B8%8B%E5%AE%9E%E8%B7%B5%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</id>
    <published>2023-04-23T08:50:50.000Z</published>
    <updated>2023-04-23T08:57:24.306Z</updated>
    
    <content type="html"><![CDATA[<h2 id="示例结构红框内的">示例结构（红框内的）</h2><p>工厂模式（Factory Pattern）是 Java中最常用的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。在工厂模式中，我们在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。</p><p>作为一种创建类模式，在任何需要生成复杂对象的地方，都可以使用工厂方法模式。有一点需要注意的地方就是复杂对象适合使用工厂模式，而简单对象，特别是只需要通过new就可以完成创建的对象，无需使用工厂模式。如果使用工厂模式，就需要引入一个工厂类，会增加系统的复杂度。</p><span id="more"></span><img src="/2023/04/23/SpringBoot%E9%A1%B9%E7%9B%AE%E4%B8%8B%E5%AE%9E%E8%B7%B5%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230423161023.png" class=""><h2 id="接口">接口</h2><p><code>com.springcloud.business.service.ICarService</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springcloud.business.service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xbronze</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICarService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="实现类">实现类</h2><p><code>com.springcloud.business.service.impl.BusServiceImpl</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springcloud.business.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.springcloud.business.service.ICarService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: xbronze</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-04-23 14:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TODO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ICarService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;大巴车一般要求时速控制在每小时80公里&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>com.springcloud.business.service.impl.SuperCarServiceImpl</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springcloud.business.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.springcloud.business.service.ICarService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: xbronze</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-04-23 14:51</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TODO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuperCarServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ICarService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;超跑的车速轻松能达到每小时200公里&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="一个工厂注册类">一个工厂注册类</h2><p><code>com.springcloud.business.service.impl.CarServiceContent</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springcloud.business.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.springcloud.business.service.ICarService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: xbronze</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-04-23 15:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TODO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarServiceContent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, ICarService&gt; carServiceMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ICarService <span class="title function_">getCarService</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (carServiceMap.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.carServiceMap.get(type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>项目启动，系统会把<code>ICarService</code>的实现类都注入到<code>carServiceMap</code>，key值为实现类上@Service注解定义的value，如果没有显式的设置value，如示例上所示，那么默认value值为类名（首字母小写）。## Controller类VehicleController</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: xbronze</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-04-23 14:54</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TODO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/vehicle&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VehicleController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IVehicleService vehicleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;type&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">vehicle</span><span class="params">(<span class="meta">@PathVariable(&quot;type&quot;)</span> String type)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> vehicleService.choose(type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="接口ivehicleservice">接口IVehicleService</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springcloud.business.service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: xbronze</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-04-23 14:54</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TODO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IVehicleService</span> &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">choose</span><span class="params">(String type)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="实现类vehicleserviceimpl">实现类VehicleServiceImpl</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springcloud.business.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.springcloud.business.service.ICarService;</span><br><span class="line"><span class="keyword">import</span> com.springcloud.business.service.IVehicleService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: xbronze</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-04-23 15:17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TODO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VehicleServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IVehicleService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CarServiceContent carServiceContent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">choose</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="type">ICarService</span> <span class="variable">carService</span> <span class="operator">=</span> carServiceContent.getCarService(type);</span><br><span class="line">        <span class="keyword">return</span> carService.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="测试">测试</h2><img src="/2023/04/23/SpringBoot%E9%A1%B9%E7%9B%AE%E4%B8%8B%E5%AE%9E%E8%B7%B5%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230423164156.png" class=""><p><br></p><img src="/2023/04/23/SpringBoot%E9%A1%B9%E7%9B%AE%E4%B8%8B%E5%AE%9E%E8%B7%B5%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230423164134.png" class=""><p><br></p><img src="/2023/04/23/SpringBoot%E9%A1%B9%E7%9B%AE%E4%B8%8B%E5%AE%9E%E8%B7%B5%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230423164322.png" class=""><p><br></p><hr /><p>完毕</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;示例结构红框内的&quot;&gt;示例结构（红框内的）&lt;/h2&gt;
&lt;p&gt;工厂模式（Factory Pattern）是 Java
中最常用的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。在工厂模式中，我们在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。&lt;/p&gt;
&lt;p&gt;作为一种创建类模式，在任何需要生成复杂对象的地方，都可以使用工厂方法模式。有一点需要注意的地方就是复杂对象适合使用工厂模式，而简单对象，特别是只需要通过
new
就可以完成创建的对象，无需使用工厂模式。如果使用工厂模式，就需要引入一个工厂类，会增加系统的复杂度。&lt;/p&gt;
    
    </summary>
    
    
      <category term="代码人生" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="工程模式" scheme="http://yoursite.com/tags/%E5%B7%A5%E7%A8%8B%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="SpringBoot" scheme="http://yoursite.com/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>单点登录解决方案</title>
    <link href="http://yoursite.com/2023/04/20/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>http://yoursite.com/2023/04/20/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</id>
    <published>2023-04-20T01:59:13.000Z</published>
    <updated>2023-04-20T11:12:27.167Z</updated>
    
    <content type="html"><![CDATA[<p>单点登录 (SSO)是一种身份验证过程，在该过程中，用户仅使用一组登录凭据即可访问多个应用程序或网站，这避免了用户分别登录不同应用程序需要输入不同验证信息的麻烦。用户凭据和其他识别信息由称为身份提供者(IdP)的集中式系统存储和管理。身份提供者是一个受信任的系统，可以提供对其他网站和应用程序的访问。基于单点登录(SSO)的身份验证系统通常用于员工需要访问其组织的多个应用程序的企业环境中。</p><span id="more"></span><h1 id="单点登录sso的好处">单点登录SSO的好处</h1><ol type="1"><li>由于 SSO允许用户使用他们自己的登录系统进行身份验证，因此它还允许管理员管理用户帐户并使员工能够在公司使用的多个应用程序中使用它。</li><li>SSO 允许管理员立即控制对所有应用程序的访问，而不是登录 100个不同的用户管理门户来更改用户权限。</li><li>重要的是，SSO还有助于提高安全性。由于只有一个系统保存所有员工信息，因此保护一个地方比保护数百个不同的帐户容易得多，后者可能成为可能的“泄漏”。</li></ol><h1 id="单点登录验证过程示例图">单点登录验证过程示例图</h1><img src="/2023/04/20/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/sso-for-login.png" class=""><p><br></p><h1 id="saml-2.0-oauth-2.0-openid-connect的对比">SAML 2.0、 OAuth 2.0、OpenID Connect的对比</h1><table><colgroup><col style="width: 25%" /><col style="width: 23%" /><col style="width: 25%" /><col style="width: 25%" /></colgroup><thead><tr class="header"><th></th><th>SAML</th><th>OAuth</th><th>OpenID Connect</th></tr></thead><tbody><tr class="odd"><td>Description</td><td>Open standard for authorization and authentication</td><td>Open standard for authorization</td><td>Open standard for authentication</td></tr><tr class="even"><td>Primary user case</td><td>SSO for enterprise applications</td><td>API authorization</td><td>SSO for consumer applications</td></tr><tr class="odd"><td>Data format</td><td>XML</td><td>JSON</td><td>JSON</td></tr></tbody></table><p><br></p><h1 id="saml-2.0-协议">SAML 2.0 协议</h1><p>SAML是唯一同时支持身份验证和授权的标准。SAML通过支持服务提供商和身份提供商端的数据签名和加密，为公司提供更多控制，以保持其SSO登录更安全。因此，如果需要，可以对整个过程的数据进行加密，并且攻击无法对其进行解密，除非他们已经可以访问服务和身份提供者的私钥。</p><img src="/2023/04/20/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/saml.png" class=""><p><br></p><p>该过程进行如下：</p><ol type="1"><li>用户向服务提供商请求启动 SSO。</li><li>服务提供商创建 base64编码的身份验证请求并将其发送给身份提供商。</li><li>身份提供者接收身份验证请求，对其进行验证，并请求用户进行身份验证（登录）。</li><li>身份提供者发送带有 base64 编码 SAML 响应的用户 XHTML 表单。</li><li>用户向服务提供商发送 SAML 响应。</li><li>服务提供商验证 SAML 响应并将用户重定向到目标资源。</li></ol><h1 id="实施单点登录">实施单点登录</h1><p>大多数情况下，身份验证请求是使用 HTTP-Redirect 或 HTTP-Post绑定发送的，因为数据负载很小。但是，由于 SAML 响应通常太大而无法放入url，因此通常的做法是使用 HTTP-Post 绑定来传输 SAML 响应数据。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;单点登录 (SSO)
是一种身份验证过程，在该过程中，用户仅使用一组登录凭据即可访问多个应用程序或网站，这避免了用户分别登录不同应用程序需要输入不同验证信息的麻烦。用户凭据和其他识别信息由称为身份提供者(IdP)的集中式系统存储和管理。身份提供者是一个受信任的系统，可以提供对其他网站和应用程序的访问。基于单点登录
(SSO)
的身份验证系统通常用于员工需要访问其组织的多个应用程序的企业环境中。&lt;/p&gt;
    
    </summary>
    
    
      <category term="代码人生" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="SSO" scheme="http://yoursite.com/tags/SSO/"/>
    
  </entry>
  
</feed>
